var at=()=>!0,_=class{constructor(t,e,n){this.root=t,this.currentNode=t,this.nodeType=e,this.filter=n||at}isAcceptableNode(t){let e=t.nodeType;return!!((e===Node.ELEMENT_NODE?1:e===Node.TEXT_NODE?4:0)&this.nodeType)&&this.filter(t)}nextNode(){let t=this.root,e=this.currentNode,n;for(;;){for(n=e.firstChild;!n&&e&&e!==t;)n=e.nextSibling,n||(e=e.parentNode);if(!n)return null;if(this.isAcceptableNode(n))return this.currentNode=n,n;e=n}}previousNode(){let t=this.root,e=this.currentNode,n;for(;;){if(e===t)return null;if(n=e.previousSibling,n)for(;e=n.lastChild;)n=e;else n=e.parentNode;if(!n)return null;if(this.isAcceptableNode(n))return this.currentNode=n,n;e=n}}previousPONode(){let t=this.root,e=this.currentNode,n;for(;;){for(n=e.lastChild;!n&&e&&e!==t;)n=e.previousSibling,n||(e=e.parentNode);if(!n)return null;if(this.isAcceptableNode(n))return this.currentNode=n,n;e=n}}};var B="\u200B",J=navigator.userAgent,de=/Mac OS X/.test(J),fe=/Windows NT/.test(J),ve=/iP(?:ad|hone|od)/.test(J)||de&&!!navigator.maxTouchPoints,yt=/Android/.test(J),qe=/Gecko\//.test(J),se=/Edge\//.test(J),ct=!se&&/WebKit\//.test(J),y=de||ve?"Meta-":"Ctrl-",ie=ct,Ue="onbeforeinput"in document&&"inputType"in new InputEvent("input"),D=/[^ \t\r\n\u200B]/;var ut=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,ht=new Set(["BR","HR","IFRAME","IMG","INPUT"]),mt=0,xe=1,We=2,ze=3,ue=new WeakMap,Ke=()=>{ue=new WeakMap},M=i=>ht.has(i.nodeName),Le=i=>{switch(i.nodeType){case 3:return xe;case 1:case 11:if(ue.has(i))return ue.get(i);break;default:return mt}let t;return Array.from(i.childNodes).every(N)?ut.test(i.nodeName)?t=xe:t=We:t=ze,ue.set(i,t),t},N=i=>Le(i)===xe,q=i=>Le(i)===We,X=i=>Le(i)===ze;var m=(i,t,e)=>{let n=document.createElement(i);if(t instanceof Array&&(e=t,t=null),t)for(let o in t){let s=t[o];s!==void 0&&n.setAttribute(o,s)}return e&&e.forEach(o=>n.appendChild(o)),n},ke=(i,t)=>M(i)||i.nodeType!==t.nodeType||i.nodeName!==t.nodeName?!1:i instanceof HTMLElement&&t instanceof HTMLElement?i.nodeName!=="A"&&i.className===t.className&&i.style.cssText===t.style.cssText:!0,he=(i,t,e)=>{if(i.nodeName!==t)return!1;for(let n in e)if(!("getAttribute"in i)||i.getAttribute(n)!==e[n])return!1;return!0},g=(i,t,e,n)=>{for(;i&&i!==t;){if(he(i,e,n))return i;i=i.parentNode}return null},me=(i,t)=>{let e=i.childNodes;for(;t&&i instanceof Element;)i=e[t-1],e=i.childNodes,t=e.length;return i},Re=(i,t)=>{let e=i;if(e instanceof Element){let n=e.childNodes;if(t<n.length)e=n[t];else{for(;e&&!e.nextSibling;)e=e.parentNode;e&&(e=e.nextSibling)}}return e},O=i=>i instanceof Element||i instanceof DocumentFragment?i.childNodes.length:i instanceof CharacterData?i.length:0,T=i=>{let t=document.createDocumentFragment(),e=i.firstChild;for(;e;)t.appendChild(e),e=i.firstChild;return t},E=i=>{let t=i.parentNode;return t&&t.removeChild(i),i},k=(i,t)=>{let e=i.parentNode;e&&e.replaceChild(t,i)};var pt=i=>i instanceof Element?i.nodeName==="BR":D.test(i.data),ee=(i,t)=>{let e=i.parentNode;for(;N(e);)e=e.parentNode;let n=new _(e,5,pt);return n.currentNode=i,!!n.nextNode()||t&&!n.previousNode()},re=(i,t)=>{let e=new _(i,4),n,o;for(;n=e.nextNode();)for(;(o=n.data.indexOf(B))>-1&&(!t||n.parentNode!==t);)if(n.length===1){let s=n,r=s.parentNode;for(;r&&(r.removeChild(s),e.currentNode=r,!(!N(r)||O(r)));)s=r,r=s.parentNode;break}else n.deleteData(o,1)};var Nt=0,gt=1,St=2,Et=3,z=(i,t,e)=>{let n=document.createRange();if(n.selectNode(t),e){let o=i.compareBoundaryPoints(Et,n)>-1,s=i.compareBoundaryPoints(gt,n)<1;return!o&&!s}else{let o=i.compareBoundaryPoints(Nt,n)<1,s=i.compareBoundaryPoints(St,n)>-1;return o&&s}},C=i=>{let{startContainer:t,startOffset:e,endContainer:n,endOffset:o}=i;for(;!(t instanceof Text);){let s=t.childNodes[e];if(!s||M(s)){if(e&&(s=t.childNodes[e-1],s instanceof Text)){let r=s,l;for(;!r.length&&(l=r.previousSibling)&&l instanceof Text;)r.remove(),r=l;t=r,e=r.data.length}break}t=s,e=0}if(o)for(;!(n instanceof Text);){let s=n.childNodes[o-1];if(!s||M(s)){if(s&&s.nodeName==="BR"&&!ee(s,!1)){o-=1;continue}break}n=s,o=O(n)}else for(;!(n instanceof Text);){let s=n.firstChild;if(!s||M(s))break;n=s}i.setStart(t,e),i.setEnd(n,o)},K=(i,t,e,n)=>{let o=i.startContainer,s=i.startOffset,r=i.endContainer,l=i.endOffset,a;for(t||(t=i.commonAncestorContainer),e||(e=t);!s&&o!==t&&o!==n;)a=o.parentNode,s=Array.from(a.childNodes).indexOf(o),o=a;for(;!(r===e||r===n||(r.nodeType!==3&&r.childNodes[l]&&r.childNodes[l].nodeName==="BR"&&!ee(r.childNodes[l],!1)&&(l+=1),l!==O(r)));)a=r.parentNode,l=Array.from(a.childNodes).indexOf(r)+1,r=a;i.setStart(o,s),i.setEnd(r,l)},ye=(i,t,e)=>{let n=g(i.endContainer,e,t);if(n&&(n=n.parentNode)){let o=i.cloneRange();K(o,n,n,e),o.endContainer===n&&(i.setStart(o.endContainer,o.endOffset),i.setEnd(o.endContainer,o.endOffset))}return i};var x=i=>{let t=null;if(i instanceof Text)return i;if(N(i)){let e=i.firstChild;if(ie)for(;e&&e instanceof Text&&!e.data;)i.removeChild(e),e=i.firstChild;e||(ie?t=document.createTextNode(B):t=document.createTextNode(""))}else if((i instanceof Element||i instanceof DocumentFragment)&&!i.querySelector("BR")&&!D.test(i.textContent||"")){t=m("BR");let e=i,n;for(;(n=e.lastElementChild)&&!N(n);)e=n;i=e}if(t)try{i.appendChild(t)}catch{}return i},w=(i,t)=>{let e=null;return/^(?:TABLE|TBODY|TR|TH|TD|P)/.test(i.nodeName)||(Array.from(i.childNodes).forEach(n=>{let o=n.nodeName==="BR";!o&&N(n)?(e||(e=m("DIV")),e.appendChild(n)):(o||e)&&(e||(e=m("DIV")),x(e),o?i.replaceChild(e,n):i.insertBefore(e,n),e=null),X(n)&&w(n,t)}),e&&i.appendChild(x(e))),i},I=(i,t,e,n)=>{if(i instanceof Text&&i!==e){if(typeof t!="number")throw new Error("Offset must be a number to split text node!");if(!i.parentNode)throw new Error("Cannot split text node with no parent!");return I(i.parentNode,i.splitText(t),e,n)}let o=typeof t=="number"?t<i.childNodes.length?i.childNodes[t]:null:t,s=i.parentNode;if(!s||i===e||!(i instanceof Element))return o;let r=i.cloneNode(!1);for(;o;){let l=o.nextSibling;r.appendChild(o),o=l}return i instanceof HTMLOListElement&&g(i,n,"BLOCKQUOTE")&&(r.start=(+i.start||1)+i.childNodes.length-1),x(i),x(r),s.insertBefore(r,i.nextSibling),I(s,r,e,n)},$e=(i,t)=>{let e=i.childNodes,n=e.length,o=[];for(;n--;){let s=e[n],r=n?e[n-1]:null;if(r&&N(s)&&ke(s,r))t.startContainer===s&&(t.startContainer=r,t.startOffset+=O(r)),t.endContainer===s&&(t.endContainer=r,t.endOffset+=O(r)),t.startContainer===i&&(t.startOffset>n?t.startOffset-=1:t.startOffset===n&&(t.startContainer=r,t.startOffset=O(r))),t.endContainer===i&&(t.endOffset>n?t.endOffset-=1:t.endOffset===n&&(t.endContainer=r,t.endOffset=O(r))),E(s),s instanceof Text?r.appendData(s.data):o.push(T(s));else if(s instanceof Element){let l;for(;l=o.pop();)s.appendChild(l);$e(s,t)}}},te=(i,t)=>{let e=i instanceof Text?i.parentNode:i;if(e instanceof Element){let n={startContainer:t.startContainer,startOffset:t.startOffset,endContainer:t.endContainer,endOffset:t.endOffset};$e(e,n),t.setStart(n.startContainer,n.startOffset),t.setEnd(n.endContainer,n.endOffset)}},V=(i,t,e,n)=>{let o=t,s,r;for(;(s=o.parentNode)&&s!==n&&s instanceof Element&&s.childNodes.length===1;)o=s;E(o),r=i.childNodes.length;let l=i.lastChild;l&&l.nodeName==="BR"&&(i.removeChild(l),r-=1),i.appendChild(T(t)),e.setStart(i,r),e.collapse(!0),te(i,e)},P=(i,t)=>{let e=i.previousSibling,n=i.firstChild,o=i.nodeName==="LI";if(!(o&&(!n||!/^[OU]L$/.test(n.nodeName)))){if(e&&ke(e,i)){if(!X(e))if(o){let r=m("DIV");r.appendChild(T(e)),e.appendChild(r)}else return;E(i);let s=!X(i);e.appendChild(T(i)),s&&w(e,t),n&&P(n,t)}else if(o){let s=m("DIV");i.insertBefore(s,n),x(s)}}};var Ze={"font-weight":{regexp:/^bold|^700/i,replace(){return m("B")}},"font-style":{regexp:/^italic/i,replace(){return m("I")}},"font-family":{regexp:D,replace(i,t){return m("SPAN",{class:i.fontFamily,style:"font-family:"+t})}},"font-size":{regexp:D,replace(i,t){return m("SPAN",{class:i.fontSize,style:"font-size:"+t})}},"text-decoration":{regexp:/^underline/i,replace(){return m("U")}}},Tt=(i,t,e)=>{let n=i.style,o,s;for(let r in Ze){let l=Ze[r],a=n.getPropertyValue(r);if(a&&l.regexp.test(a)){let d=l.replace(e.classNames,a);if(d.nodeName===i.nodeName&&d.className===i.className)continue;s||(s=d),o&&o.appendChild(d),o=d,i.style.removeProperty(r)}}return s&&o&&(o.appendChild(T(i)),i.style.cssText?i.appendChild(s):k(i,s)),o||i},pe=i=>(t,e)=>{let n=m(i),o=t.attributes;for(let s=0,r=o.length;s<r;s+=1){let l=o[s];n.setAttribute(l.name,l.value)}return e.replaceChild(n,t),n.appendChild(T(t)),n},_t={1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"},Ct={STRONG:pe("B"),EM:pe("I"),INS:pe("U"),STRIKE:pe("S"),SPAN:Tt,FONT:(i,t,e)=>{let n=i,o=n.face,s=n.size,r=n.color,l=e.classNames,a,d,c,u,f;return o&&(a=m("SPAN",{class:l.fontFamily,style:"font-family:"+o}),f=a,u=a),s&&(d=m("SPAN",{class:l.fontSize,style:"font-size:"+_t[s]+"px"}),f||(f=d),u&&u.appendChild(d),u=d),r&&/^#?([\dA-F]{3}){1,2}$/i.test(r)&&(r.charAt(0)!=="#"&&(r="#"+r),c=m("SPAN",{class:l.color,style:"color:"+r}),f||(f=c),u&&u.appendChild(c),u=c),(!f||!u)&&(f=u=m("SPAN")),t.replaceChild(f,n),u.appendChild(T(n)),u},TT:(i,t,e)=>{let n=m("SPAN",{class:e.classNames.fontFamily,style:'font-family:menlo,consolas,"courier new",monospace'});return t.replaceChild(n,i),n.appendChild(T(i)),n}},vt=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,xt=/^(?:HEAD|META|STYLE)/,Ne=(i,t,e)=>{let n=i.childNodes,o=i;for(;N(o);)o=o.parentNode;let s=new _(o,5);for(let r=0,l=n.length;r<l;r+=1){let a=n[r],d=a.nodeName,c=Ct[d];if(a instanceof HTMLElement){let u=a.childNodes.length;if(c)a=c(a,i,t);else if(xt.test(d)){i.removeChild(a),r-=1,l-=1;continue}else if(!vt.test(d)&&!N(a)){r-=1,l+=u-1,i.replaceChild(T(a),a);continue}u&&Ne(a,t,e||d==="PRE")}else{if(a instanceof Text){let u=a.data,f=!D.test(u.charAt(0)),p=!D.test(u.charAt(u.length-1));if(e||!f&&!p)continue;if(f){s.currentNode=a;let h;for(;(h=s.previousPONode())&&!(h.nodeName==="IMG"||h instanceof Text&&D.test(h.data));)if(!N(h)){h=null;break}u=u.replace(/^[ \t\r\n]+/g,h?" ":"")}if(p){s.currentNode=a;let h;for(;(h=s.nextNode())&&!(h.nodeName==="IMG"||h instanceof Text&&D.test(h.data));)if(!N(h)){h=null;break}u=u.replace(/[ \t\r\n]+$/g,h?" ":"")}if(u){a.data=u;continue}}i.removeChild(a),r-=1,l-=1}}return i},ge=i=>{let t=i.childNodes,e=t.length;for(;e--;){let n=t[e];n instanceof Element&&!M(n)?(ge(n),N(n)&&!n.firstChild&&i.removeChild(n)):n instanceof Text&&!n.data&&i.removeChild(n)}},le=(i,t,e)=>{let n=i.querySelectorAll("BR"),o=[],s=n.length;for(let r=0;r<s;r+=1)o[r]=ee(n[r],e);for(;s--;){let r=n[s],l=r.parentNode;l&&(o[s]?N(l)||w(l,t):E(r))}},Oe=i=>i.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;");var ae=(i,t)=>{let e=new _(t,1,q);return e.currentNode=i,e},W=(i,t)=>{let e=ae(i,t).previousNode();return e!==t?e:null},H=(i,t)=>{let e=ae(i,t).nextNode();return e!==t?e:null},ce=i=>!i.textContent&&!i.querySelector("IMG");var v=(i,t)=>{let e=i.startContainer,n;if(N(e))n=W(e,t);else if(e!==t&&e instanceof HTMLElement&&q(e))n=e;else{let o=me(e,i.startOffset);n=H(o,t)}return n&&z(i,n,!0)?n:null},$=(i,t)=>{let e=i.endContainer,n;if(N(e))n=W(e,t);else if(e!==t&&e instanceof HTMLElement&&q(e))n=e;else{let o=Re(e,i.endOffset);if(!o||!t.contains(o)){o=t;let s;for(;s=o.lastChild;)o=s}n=W(o,t)}return n&&z(i,n,!0)?n:null},Ge=i=>i instanceof Text?D.test(i.data):i.nodeName==="IMG",j=(i,t)=>{let e=i.startContainer,n=i.startOffset,o;if(e instanceof Text){let l=e.data;for(let a=n;a>0;a-=1)if(l.charAt(a-1)!==B)return!1;o=e}else if(o=Re(e,n),o&&!t.contains(o)&&(o=null),!o&&(o=me(e,n),o instanceof Text&&o.length))return!1;let s=v(i,t);if(!s)return!1;let r=new _(s,5,Ge);return r.currentNode=o,!r.previousNode()},Z=(i,t)=>{let e=i.endContainer,n=i.endOffset,o;if(e instanceof Text){let l=e.data,a=l.length;for(let d=n;d<a;d+=1)if(l.charAt(d)!==B)return!1;o=e}else o=me(e,n);let s=$(i,t);if(!s)return!1;let r=new _(s,5,Ge);return r.currentNode=o,!r.nextNode()},Be=(i,t)=>{let e=v(i,t),n=$(i,t),o;e&&n&&(o=e.parentNode,i.setStart(o,Array.from(o.childNodes).indexOf(e)),o=n.parentNode,i.setEnd(o,Array.from(o.childNodes).indexOf(n)+1))};function Q(i,t,e,n){let o=document.createRange();return o.setStart(i,t),e&&typeof n=="number"?o.setEnd(e,n):o.setEnd(i,t),o}var G=(i,t)=>{let{startContainer:e,startOffset:n,endContainer:o,endOffset:s}=i,r;if(e instanceof Text){let a=e.parentNode;if(r=a.childNodes,n===e.length)n=Array.from(r).indexOf(e)+1,i.collapsed&&(o=a,s=n);else{if(n){let d=e.splitText(n);o===e?(s-=n,o=d):o===a&&(s+=1),e=d}n=Array.from(r).indexOf(e)}e=a}else r=e.childNodes;let l=r.length;n===l?e.appendChild(t):e.insertBefore(t,r[n]),e===o&&(s+=r.length-l),i.setStart(e,n),i.setEnd(o,s)},De=(i,t,e)=>{let n=document.createDocumentFragment();if(i.collapsed)return n;t||(t=i.commonAncestorContainer),t instanceof Text&&(t=t.parentNode);let o=i.startContainer,s=i.startOffset,r=I(i.endContainer,i.endOffset,t,e),l=0,a=I(o,s,t,e);for(;a&&a!==r;){let d=a.nextSibling;n.appendChild(a),a=d}return a=r&&r.previousSibling,a&&a instanceof Text&&r instanceof Text&&(l=a.length,a.appendData(r.data),E(r),r=a),i.setStart(o,s),r?i.setEnd(r,l):i.setEnd(t,t.childNodes.length),x(t),n},Xe=(i,t,e)=>{i.currentNode=e;let n;for(;n=i[t]();){if(n instanceof Text||M(n))return n;if(!N(n))return null}return null},F=(i,t)=>{let e=v(i,t),n=$(i,t),o=e!==n;e&&n&&(C(i),K(i,e,n,t));let s=De(i,null,t);C(i),o&&(n=$(i,t),e&&n&&e!==n&&V(e,n,i,t)),e&&x(e);let r=t.firstChild;(!r||r.nodeName==="BR")&&(x(t),t.firstChild&&i.selectNodeContents(t.firstChild)),i.collapse(!0);let l=i.startContainer,a=i.startOffset,d=new _(t,5),c=l,u=a;(!(c instanceof Text)||u===c.data.length)&&(c=Xe(d,"nextNode",c),u=0);let f=l,p=a-1;(!(f instanceof Text)||p===-1)&&(f=Xe(d,"previousPONode",c||(l instanceof Text?l:l.childNodes[a]||l)),f instanceof Text&&(p=f.data.length));let h=null,S=0;return c instanceof Text&&c.data.charAt(u)===" "&&j(i,t)?(h=c,S=u):f instanceof Text&&f.data.charAt(p)===" "&&(c instanceof Text&&c.data.charAt(u)===" "||Z(i,t))&&(h=f,S=p),h&&h.replaceData(S,1,"\xA0"),i.setStart(l,a),i.collapse(!0),s},je=(i,t,e)=>{let n=t.firstChild&&N(t.firstChild),o;for(w(t,e),o=t;o=H(o,e);)x(o);i.collapsed||F(i,e),C(i),i.collapse(!1);let s=g(i.endContainer,e,"BLOCKQUOTE")||e,r=v(i,e),l=null,a=H(t,t),d=!n&&!!r&&ce(r);if(r&&a&&!d&&!g(a,t,"PRE")&&!g(a,t,"TABLE")){K(i,r,r,e),i.collapse(!0);let c=i.endContainer,u=i.endOffset;if(le(r,e,!1),N(c)){let f=I(c,u,W(c,e)||e,e);c=f.parentNode,u=Array.from(c.childNodes).indexOf(f)}if(u!==O(c))for(l=document.createDocumentFragment();o=c.childNodes[u];)l.appendChild(o);V(c,a,i,e),u=Array.from(c.parentNode.childNodes).indexOf(c)+1,c=c.parentNode,i.setEnd(c,u)}if(O(t)){d&&r&&(i.setEndBefore(r),i.collapse(!1),E(r)),K(i,s,s,e);let c=I(i.endContainer,i.endOffset,s,e),u=c?c.previousSibling:s.lastChild;s.insertBefore(t,c),c?i.setEndBefore(c):i.setEnd(s,O(s)),r=$(i,e),C(i);let f=i.endContainer,p=i.endOffset;c&&X(c)&&P(c,e),c=u&&u.nextSibling,c&&X(c)&&P(c,e),i.setEnd(f,p)}if(l&&r){let c=i.cloneRange();x(l),V(r,l,c,e),i.setEnd(c.endContainer,c.endOffset)}C(i)};var Se=i=>{if(i.collapsed)return"";let t=i.startContainer,e=i.endContainer,n=new _(i.commonAncestorContainer,5,a=>z(i,a,!0));n.currentNode=t;let o=t,s="",r=!1,l;for((!(o instanceof Element)&&!(o instanceof Text)||!n.filter(o))&&(o=n.nextNode());o;)o instanceof Text?(l=o.data,l&&/\S/.test(l)&&(o===e&&(l=l.slice(0,i.endOffset)),o===t&&(l=l.slice(i.startOffset)),s+=l,r=!0)):(o.nodeName==="BR"||r&&!N(o))&&(s+=`
`,r=!1),o=n.nextNode();return s=s.replace(/ /g," "),s};var we=Array.prototype.indexOf,Qe=(i,t,e,n,o,s,r)=>{let l=i.clipboardData;if(se||!l)return!1;let a=s?"":Se(t),d=v(t,e),c=$(t,e),u=e;d===c&&d?.contains(t.commonAncestorContainer)&&(u=d);let f;n?f=F(t,e):f=t.cloneContents();let p=t.commonAncestorContainer;for(p instanceof Text&&(p=p.parentNode);p&&p!==u;){let S=p.cloneNode(!1);S.appendChild(f),f=S,p=p.parentNode}let h;if(f.childNodes.length===1&&f.childNodes[0]instanceof Text)a=f.childNodes[0].data.replace(/ /g," "),r=!0;else{let S=m("DIV");S.appendChild(f),h=S.innerHTML,o&&(h=o(h))}return s&&h!==void 0&&(a=s(h)),fe&&(a=a.replace(/\r?\n/g,`\r
`)),!r&&h&&a!==h&&(h="<!-- squire -->"+h,l.setData("text/html",h)),l.setData("text/plain",a),i.preventDefault(),!0},Ye=function(i){let t=this.getSelection(),e=this._root;if(t.collapsed){i.preventDefault();return}this.saveUndoState(t),Qe(i,t,e,!0,this._config.willCutCopy,this._config.toPlainText,!1)||setTimeout(()=>{try{this._ensureBottomLine()}catch(o){this._config.didError(o)}},0),this.setSelection(t)},Ve=function(i){Qe(i,this.getSelection(),this._root,!1,this._config.willCutCopy,this._config.toPlainText,!1)},Ae=function(i){this._isShiftDown=i.shiftKey},Je=function(i){let t=i.clipboardData,e=t?.items,n=this._isShiftDown,o=!1,s=!1,r=null,l=null;if(e){let L=e.length;for(;L--;){let R=e[L],A=R.type;A==="text/html"?l=R:A==="text/plain"||A==="text/uri-list"?r=R:A==="text/rtf"?o=!0:/^image\/.*/.test(A)&&(s=!0)}if(s&&!(o&&l)){i.preventDefault(),this.fireEvent("pasteImage",{clipboardData:t});return}if(!se){i.preventDefault(),l&&(!n||!r)?l.getAsString(R=>{this.insertHTML(R,!0)}):r&&r.getAsString(R=>{let A=!1,Pe=this.getSelection();if(!Pe.collapsed&&D.test(Pe.toString())){let Fe=this.linkRegExp.exec(R);A=!!Fe&&Fe[0].length===R.length}A?this.makeLink(R):this.insertPlainText(R,!0)});return}}let a=t?.types;if(!se&&a&&(we.call(a,"text/html")>-1||!qe&&we.call(a,"text/plain")>-1&&we.call(a,"text/rtf")<0)){i.preventDefault();let L;!n&&(L=t.getData("text/html"))?this.insertHTML(L,!0):((L=t.getData("text/plain"))||(L=t.getData("text/uri-list")))&&this.insertPlainText(L,!0);return}let d=document.body,c=this.getSelection(),u=c.startContainer,f=c.startOffset,p=c.endContainer,h=c.endOffset,S=m("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});d.appendChild(S),c.selectNodeContents(S),this.setSelection(c),setTimeout(()=>{try{let L="",R=S,A;for(;S=R;)R=S.nextSibling,E(S),A=S.firstChild,A&&A===S.lastChild&&A instanceof HTMLDivElement&&(S=A),L+=S.innerHTML;this.setSelection(Q(u,f,p,h)),L&&this.insertHTML(L,!0)}catch(L){this._config.didError(L)}},0)},et=function(i){if(!i.dataTransfer)return;let t=i.dataTransfer.types,e=t.length,n=!1,o=!1;for(;e--;)switch(t[e]){case"text/plain":n=!0;break;case"text/html":o=!0;break;default:return}(o||n&&this.saveUndoState)&&this.saveUndoState()};var Ie=(i,t,e)=>{t.preventDefault(),i.splitBlock(t.shiftKey,e)};var ne=(i,t)=>{try{t||(t=i.getSelection());let e=t.startContainer;e instanceof Text&&(e=e.parentNode);let n=e;for(;N(n)&&(!n.textContent||n.textContent===B);)e=n,n=e.parentNode;e!==n&&(t.setStart(n,Array.from(n.childNodes).indexOf(e)),t.collapse(!0),n.removeChild(e),q(n)||(n=W(n,i._root)||i._root),x(n),C(t)),e===i._root&&(e=e.firstChild)&&e.nodeName==="BR"&&E(e),i._ensureBottomLine(),i.setSelection(t),i._updatePath(t,!0)}catch(e){i._config.didError(e)}},Ee=(i,t)=>{let e;for(;(e=i.parentNode)&&!(e===t||e.isContentEditable);)i=e;E(i)},Te=(i,t,e)=>{if(g(t,i._root,"A"))return;let n=t.data||"",o=Math.max(n.lastIndexOf(" ",e-1),n.lastIndexOf("\xA0",e-1))+1,s=n.slice(o,e),r=i.linkRegExp.exec(s);if(r){let l=i.getSelection();i._docWasChanged(),i._recordUndoState(l),i._getRangeAndRemoveBookmark(l);let a=o+r.index,d=a+r[0].length,c=l.startContainer===t,u=l.startOffset-d;a&&(t=t.splitText(a));let f=i._config.tagAttributes.a,p=m("A",Object.assign({href:r[1]?/^(?:ht|f)tps?:/i.test(r[1])?r[1]:"http://"+r[1]:"mailto:"+r[0]},f));p.textContent=n.slice(a,d),t.parentNode.insertBefore(p,t),t.data=n.slice(d),c&&(l.setStart(t,u),l.setEnd(t,u)),i.setSelection(l)}};var tt=(i,t,e)=>{let n=i._root;if(i._removeZWS(),i.saveUndoState(e),!e.collapsed)t.preventDefault(),F(e,n),ne(i,e);else if(j(e,n)){t.preventDefault();let o=v(e,n);if(!o)return;let s=o;w(s.parentNode,n);let r=W(s,n);if(r){if(!r.isContentEditable){Ee(r,n);return}for(V(r,s,e,n),s=r.parentNode;s!==n&&!s.nextSibling;)s=s.parentNode;s!==n&&(s=s.nextSibling)&&P(s,n),i.setSelection(e)}else if(s){if(g(s,n,"UL")||g(s,n,"OL")){i.decreaseListLevel(e);return}else if(g(s,n,"BLOCKQUOTE")){i.removeQuote(e);return}i.setSelection(e),i._updatePath(e,!0)}}else{C(e);let o=e.startContainer,s=e.startOffset,r=o.parentNode;o instanceof Text&&r instanceof HTMLAnchorElement&&s&&r.href.includes(o.data)?(o.deleteData(s-1,1),i.setSelection(e),i.removeLink(),t.preventDefault()):(i.setSelection(e),setTimeout(()=>{ne(i)},0))}};var nt=(i,t,e)=>{let n=i._root,o,s,r,l,a,d;if(i._removeZWS(),i.saveUndoState(e),!e.collapsed)t.preventDefault(),F(e,n),ne(i,e);else if(Z(e,n)){if(t.preventDefault(),o=v(e,n),!o)return;if(w(o.parentNode,n),s=H(o,n),s){if(!s.isContentEditable){Ee(s,n);return}for(V(o,s,e,n),s=o.parentNode;s!==n&&!s.nextSibling;)s=s.parentNode;s!==n&&(s=s.nextSibling)&&P(s,n),i.setSelection(e),i._updatePath(e,!0)}}else{if(r=e.cloneRange(),K(e,n,n,n),l=e.endContainer,a=e.endOffset,l instanceof Element&&(d=l.childNodes[a],d&&d.nodeName==="IMG")){t.preventDefault(),E(d),C(e),ne(i,e);return}i.setSelection(r),setTimeout(()=>{ne(i)},0)}};var it=(i,t,e)=>{let n=i._root;if(i._removeZWS(),e.collapsed&&j(e,n)){let o=v(e,n),s;for(;s=o.parentNode;){if(s.nodeName==="UL"||s.nodeName==="OL"){t.preventDefault(),i.increaseListLevel(e);break}o=s}}},ot=(i,t,e)=>{let n=i._root;if(i._removeZWS(),e.collapsed&&j(e,n)){let o=e.startContainer;(g(o,n,"UL")||g(o,n,"OL"))&&(t.preventDefault(),i.decreaseListLevel(e))}};var st=(i,t,e)=>{let n,o=i._root;if(i._recordUndoState(e),i._getRangeAndRemoveBookmark(e),!e.collapsed)F(e,o),i._ensureBottomLine(),i.setSelection(e),i._updatePath(e,!0);else if(Z(e,o)){let s=v(e,o);if(s&&s.nodeName!=="PRE"){let r=s.textContent?.trimEnd().replace(B,"");if(r==="*"||r==="1."){t.preventDefault(),i.insertPlainText(" ",!1),i._docWasChanged(),i.saveUndoState(e);let l=new _(s,4),a;for(;a=l.nextNode();)E(a);r==="*"?i.makeUnorderedList():i.makeOrderedList();return}}}if(n=e.endContainer,e.endOffset===O(n))do if(n.nodeName==="A"){e.setStartAfter(n);break}while(!n.nextSibling&&(n=n.parentNode)&&n!==o);if(i._config.addLinks){let s=e.cloneRange();C(s);let r=s.startContainer,l=s.startOffset;setTimeout(()=>{Te(i,r,l)},0)}i.setSelection(e)};var rt=function(i){if(i.defaultPrevented||i.isComposing)return;let t=i.key,e="",n=i.code;/^Digit\d$/.test(n)&&(t=n.slice(-1)),t!=="Backspace"&&t!=="Delete"&&(i.altKey&&(e+="Alt-"),i.ctrlKey&&(e+="Ctrl-"),i.metaKey&&(e+="Meta-"),i.shiftKey&&(e+="Shift-")),fe&&i.shiftKey&&t==="Delete"&&(e+="Shift-"),t=e+t;let o=this.getSelection(),s=this._keyHandlers[t];s?s(this,i,o):!o.collapsed&&!i.ctrlKey&&!i.metaKey&&t.length===1&&(this.saveUndoState(o),F(o,this._root),this._ensureBottomLine(),this.setSelection(o),this._updatePath(o,!0))},b={Backspace:tt,Delete:nt,Tab:it,"Shift-Tab":ot," ":st,ArrowLeft(i){i._removeZWS()},ArrowRight(i,t,e){i._removeZWS();let n=i.getRoot();if(Z(e,n)){C(e);let o=e.endContainer;do if(o.nodeName==="CODE"){let s=o.nextSibling;if(!(s instanceof Text)){let r=document.createTextNode("\xA0");o.parentNode.insertBefore(r,s),s=r}e.setStart(s,1),i.setSelection(e),t.preventDefault();break}while(!o.nextSibling&&(o=o.parentNode)&&o!==n)}}};Ue||(b.Enter=Ie,b["Shift-Enter"]=Ie);!de&&!ve&&(b.PageUp=i=>{i.moveCursorToStart()},b.PageDown=i=>{i.moveCursorToEnd()});var oe=(i,t)=>(t=t||null,(e,n)=>{n.preventDefault();let o=e.getSelection();e.hasFormat(i,null,o)?e.changeFormat(null,{tag:i},o):e.changeFormat({tag:i},t,o)});b[y+"b"]=oe("B");b[y+"i"]=oe("I");b[y+"u"]=oe("U");b[y+"Shift-7"]=oe("S");b[y+"Shift-5"]=oe("SUB",{tag:"SUP"});b[y+"Shift-6"]=oe("SUP",{tag:"SUB"});b[y+"Shift-8"]=(i,t)=>{t.preventDefault();let e=i.getPath();/(?:^|>)UL/.test(e)?i.removeList():i.makeUnorderedList()};b[y+"Shift-9"]=(i,t)=>{t.preventDefault();let e=i.getPath();/(?:^|>)OL/.test(e)?i.removeList():i.makeOrderedList()};b[y+"["]=(i,t)=>{t.preventDefault();let e=i.getPath();/(?:^|>)BLOCKQUOTE/.test(e)||!/(?:^|>)[OU]L/.test(e)?i.decreaseQuoteLevel():i.decreaseListLevel()};b[y+"]"]=(i,t)=>{t.preventDefault();let e=i.getPath();/(?:^|>)BLOCKQUOTE/.test(e)||!/(?:^|>)[OU]L/.test(e)?i.increaseQuoteLevel():i.increaseListLevel()};b[y+"d"]=(i,t)=>{t.preventDefault(),i.toggleCode()};b[y+"z"]=(i,t)=>{t.preventDefault(),i.undo()};b[y+"y"]=b[y+"Shift-z"]=b[y+"Shift-Z"]=(i,t)=>{t.preventDefault(),i.redo()};var He=8,lt=40,Me=1200,Lt=[{pos:"nw",cursor:"nwse-resize"},{pos:"n",cursor:"ns-resize"},{pos:"ne",cursor:"nesw-resize"},{pos:"e",cursor:"ew-resize"},{pos:"se",cursor:"nwse-resize"},{pos:"s",cursor:"ns-resize"},{pos:"sw",cursor:"nesw-resize"},{pos:"w",cursor:"ew-resize"}],kt={ArrowUp:(i,t,e)=>{let n=v(t,e);if(n){let o=W(n,e);o&&(t.selectNodeContents(o),t.collapse(!1),i.setSelection(t).focus())}},ArrowDown:(i,t,e)=>{let n=v(t,e);if(n){let o=H(n,e);o&&(t.selectNodeContents(o),t.collapse(!0),i.setSelection(t).focus())}},Delete:(i,t)=>{i.replaceWithBlankLine(t)},Backspace:(i,t)=>{i.replaceWithBlankLine(t)}},_e=class{constructor(t,e){this._currentImage=null;this._resizeContainer=null;this._handles=null;this._currentHandle=null;this._startX=0;this._startY=0;this._startWidth=0;this._startHeight=0;this._maxWidth=Me;this._originalRatio=1;this._editor=e,this._root=t,document.addEventListener("click",this),e.addEventListener("drop",this)}destroy(){this._deselectImage(),this._editor.removeEventListener("drop",this),document.removeEventListener("click",this)}handleEvent(t){switch(t.type){case"click":this._onClick(t);break;case"pointerdown":this._onPointerDown(t);break;case"pointermove":this._onPointerMove(t);break;case"pointercancel":case"pointerup":this._onPointerUp(t);break;case"keydown":this._onKeyDown(t);break;case"drop":this._deselectImage();break}}_onClick(t){let e=t.target;e.nodeName==="IMG"&&this._root.contains(e)?(t.stopPropagation(),this._selectImage(e)):this._currentImage&&this._handles&&!this._handles.some(n=>n.element===e)&&this._deselectImage()}_deselectImage(){this._currentImage&&(document.removeEventListener("keydown",this),this._currentHandle&&this._onPointerUp({preventDefault(){},target:this._currentHandle.element}),this._handles&&this._handles.forEach(({element:t})=>t.removeEventListener("pointerdown",this)),this._resizeContainer&&this._resizeContainer.remove(),this._handles=null,this._resizeContainer=null,this._currentImage=null)}_selectImage(t){if(this._currentImage===t)return;this._deselectImage(),this._root.blur();let e=Lt.map(({pos:s,cursor:r})=>{let l=He/2,a="";switch(s){case"nw":a=`left: -${l}px; top: -${l}px;`;break;case"n":a=`left: calc(50% - ${l}px); top: -${l}px;`;break;case"ne":a=`right: -${l}px; top: -${l}px;`;break;case"e":a=`right: -${l}px; top: calc(50% - ${l}px);`;break;case"se":a=`right: -${l}px; bottom: -${l}px;`;break;case"s":a=`left: calc(50% - ${l}px); bottom: -${l}px;`;break;case"sw":a=`left: -${l}px; bottom: -${l}px;`;break;case"w":a=`left: -${l}px; top: calc(50% - ${l}px);`;break}let d=m("div",{class:`squire-resize-handle squire-resize-handle-${s}`,style:`
                    position: absolute;
                    width: ${He}px;
                    height: ${He}px;
                    background: #0067b9;
                    border: 1px solid #fff;
                    cursor: ${r};
                    pointer-events: auto;
                    touch-action: none;
                    box-shadow: 0 1px 3px rgba(0,0,0,0.3);
                    ${a}
                `});return d.addEventListener("pointerdown",this),{element:d,cursor:r,position:s}}),n=m("div",{class:"squire-image-resize-container",style:"position: absolute; pointer-events: none; z-index: 1000;"},e.map(s=>s.element));this._currentImage=t,this._resizeContainer=n,this._handles=e,this._root.appendChild(this._resizeContainer);let o=t.naturalWidth;this._originalRatio=o/t.naturalHeight,this._maxWidth=Math.min(o*2,t.parentElement?t.parentElement.offsetWidth:Me,Me),this._positionResizeContainer(),document.addEventListener("keydown",this)}_positionResizeContainer(){let t=this._resizeContainer,e=this._root,n=this._currentImage;if(!t||!n)return;let o=e.getBoundingClientRect(),s=n.getBoundingClientRect(),r=s.top-o.top+e.scrollTop,l=s.left-o.left+e.scrollLeft,a=s.width,d=s.height;t.style.top=r+"px",t.style.left=l+"px",t.style.width=a+"px",t.style.height=d+"px"}_onPointerDown(t){if(this._currentHandle||!this._handles)return;let e=t.target,n=this._handles.find(r=>r.element===e)||null;if(!n)return;let o=this._currentImage;if(!o)return;t.preventDefault(),t.stopPropagation(),e.addEventListener("pointermove",this),e.addEventListener("pointerup",this),e.addEventListener("pointercancel",this),e.setPointerCapture(t.pointerId),this._currentHandle=n,this._startX=t.clientX,this._startY=t.clientY;let s=getComputedStyle(o);this._startWidth=parseFloat(s.width),this._startHeight=parseFloat(s.height),document.body.style.cursor=n.cursor}_onPointerMove(t){t.preventDefault();let e=this._currentHandle,n=this._currentImage;if(!e||!n)return;let o=t.clientX-this._startX,s=t.clientY-this._startY,r=this._maxWidth,l=this._originalRatio,a=this._startWidth,d=this._startHeight;switch(e.position){case"sw":case"nw":case"w":a-=2*o;break;case"se":case"ne":case"e":a+=2*o;break;case"n":d-=s,a=d*l;break;case"s":d+=s,a=d*l;break}a<lt?a=lt:a>r&&(a=r);let c=n.style;c.width=a+"px",c.height="auto",this._positionResizeContainer()}_onPointerUp(t){t.preventDefault();let e=t.target;e&&(e.removeEventListener("pointermove",this),e.removeEventListener("pointerup",this),e.removeEventListener("pointercancel",this)),this._currentHandle=null,document.body.style.cursor=""}_onKeyDown(t){t.preventDefault(),t.stopPropagation();let e=kt[t.key];if(!e)return;let n=this._currentImage;if(!n)return;let o=this._editor,s=this._root;this._deselectImage();let r=o.getSelection();r.selectNode(n),e(o,r,s)}};var Ce=class{constructor(t,e){this.customEvents=new Set(["pathChange","select","input","pasteImage","undoStateChange"]);this.startSelectionId="squire-selection-start";this.endSelectionId="squire-selection-end";this.linkRegExp=/\b(?:((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()\[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w\-]+\.)+[a-z]{2,}\b(?:[?][^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+)*)?))/i;this.tagAfterSplit={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"};this._root=t,this._config=this._makeConfig(e),this._isFocused=!1,this._lastSelection=Q(t,0),this._willRestoreSelection=!1,this._mayHaveZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._events=new Map,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,this.addEventListener("selectionchange",this._updatePathOnEvent),this.addEventListener("blur",this._enableRestoreSelection),this.addEventListener("mousedown",this._disableRestoreSelection),this.addEventListener("touchstart",this._disableRestoreSelection),this.addEventListener("focus",this._restoreSelection),this.addEventListener("blur",this._removeZWS),this._isShiftDown=!1,this.addEventListener("cut",Ye),this.addEventListener("copy",Ve),this.addEventListener("paste",Je),this.addEventListener("drop",et),this.addEventListener("keydown",Ae),this.addEventListener("keyup",Ae),this.addEventListener("keydown",rt),this._keyHandlers=Object.create(b);let n=new MutationObserver(()=>this._docWasChanged());n.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=n,t.setAttribute("contenteditable","true"),this.addEventListener("beforeinput",this._beforeInput),this._imageResizer=new _e(t,this),this.setHTML("")}destroy(){this._events.forEach((t,e)=>{this.removeEventListener(e)}),this._mutation.disconnect(),this._imageResizer.destroy(),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0}_makeConfig(t){let e={blockTag:"DIV",blockAttributes:null,tagAttributes:{},classNames:{color:"color",fontFamily:"font",fontSize:"size",highlight:"highlight"},undo:{documentSizeThreshold:-1,undoLimit:-1},addLinks:!0,willCutCopy:null,toPlainText:null,sanitizeToDOMFragment:n=>{let o=DOMPurify.sanitize(n,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0,FORCE_BODY:!1});return o?document.importNode(o,!0):document.createDocumentFragment()},didError:n=>console.log(n)};return t&&(Object.assign(e,t),e.blockTag=e.blockTag.toUpperCase()),e}setKeyHandler(t,e){return this._keyHandlers[t]=e,this}_beforeInput(t){switch(t.inputType){case"insertLineBreak":t.preventDefault(),this.splitBlock(!0);break;case"insertParagraph":t.preventDefault(),this.splitBlock(!1);break;case"insertOrderedList":t.preventDefault(),this.makeOrderedList();break;case"insertUnoderedList":t.preventDefault(),this.makeUnorderedList();break;case"historyUndo":t.preventDefault(),this.undo();break;case"historyRedo":t.preventDefault(),this.redo();break;case"formatBold":t.preventDefault(),this.bold();break;case"formaItalic":t.preventDefault(),this.italic();break;case"formatUnderline":t.preventDefault(),this.underline();break;case"formatStrikeThrough":t.preventDefault(),this.strikethrough();break;case"formatSuperscript":t.preventDefault(),this.superscript();break;case"formatSubscript":t.preventDefault(),this.subscript();break;case"formatJustifyFull":case"formatJustifyCenter":case"formatJustifyRight":case"formatJustifyLeft":{t.preventDefault();let e=t.inputType.slice(13).toLowerCase();e==="full"&&(e="justify"),this.setTextAlignment(e);break}case"formatRemove":t.preventDefault(),this.removeAllFormatting();break;case"formatSetBlockTextDirection":{t.preventDefault();let e=t.data;e==="null"&&(e=null),this.setTextDirection(e);break}case"formatBackColor":t.preventDefault(),this.setHighlightColor(t.data);break;case"formatFontColor":t.preventDefault(),this.setTextColor(t.data);break;case"formatFontName":t.preventDefault(),this.setFontFace(t.data);break}}handleEvent(t){this.fireEvent(t.type,t)}fireEvent(t,e){let n=this._events.get(t);if(/^(?:focus|blur)/.test(t)){let o=this._root===document.activeElement;if(t==="focus"){if(!o||this._isFocused)return this;this._isFocused=!0}else{if(o||!this._isFocused)return this;this._isFocused=!1}}if(n){let o=e instanceof Event?e:new CustomEvent(t,{detail:e});n=n.slice();for(let s of n)try{"handleEvent"in s?s.handleEvent(o):s.call(this,o)}catch(r){this._config.didError(r)}}return this}addEventListener(t,e){let n=this._events.get(t),o=this._root;return n||(n=[],this._events.set(t,n),this.customEvents.has(t)||(t==="selectionchange"&&(o=document),o.addEventListener(t,this,!0))),n.push(e),this}removeEventListener(t,e){let n=this._events.get(t),o=this._root;if(n){if(e){let s=n.length;for(;s--;)n[s]===e&&n.splice(s,1)}else n.length=0;n.length||(this._events.delete(t),this.customEvents.has(t)||(t==="selectionchange"&&(o=document),o.removeEventListener(t,this,!0)))}return this}focus(){return this._root.focus({preventScroll:!0}),this}blur(){return this._root.blur(),this}_enableRestoreSelection(){this._willRestoreSelection=!0}_disableRestoreSelection(){this._willRestoreSelection=!1}_restoreSelection(){this._willRestoreSelection&&this.setSelection(this._lastSelection)}_removeZWS(){this._mayHaveZWS&&(re(this._root),this._mayHaveZWS=!1)}_saveRangeToBookmark(t){let e=m("INPUT",{id:this.startSelectionId,type:"hidden"}),n=m("INPUT",{id:this.endSelectionId,type:"hidden"}),o;G(t,e),t.collapse(!1),G(t,n),e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_PRECEDING&&(e.id=this.endSelectionId,n.id=this.startSelectionId,o=e,e=n,n=o),t.setStartAfter(e),t.setEndBefore(n)}_getRangeAndRemoveBookmark(t){let e=this._root,n=e.querySelector("#"+this.startSelectionId),o=e.querySelector("#"+this.endSelectionId);if(n&&o){let s=n.parentNode,r=o.parentNode,l=Array.from(s.childNodes).indexOf(n),a=Array.from(r.childNodes).indexOf(o);s===r&&(a-=1),n.remove(),o.remove(),t||(t=document.createRange()),t.setStart(s,l),t.setEnd(r,a),te(s,t),s!==r&&te(r,t),t.collapsed&&(s=t.startContainer,s instanceof Text&&(r=s.childNodes[t.startOffset],(!r||!(r instanceof Text))&&(r=s.childNodes[t.startOffset-1]),r&&r instanceof Text&&(t.setStart(r,0),t.collapse(!0))))}return t||null}getSelection(){let t=window.getSelection(),e=this._root,n=null;if(this._isFocused&&t&&t.rangeCount){n=t.getRangeAt(0).cloneRange();let o=n.startContainer,s=n.endContainer;o&&M(o)&&n.setStartBefore(o),s&&M(s)&&n.setEndBefore(s)}return n&&e.contains(n.commonAncestorContainer)?this._lastSelection=n:(n=this._lastSelection,document.contains(n.commonAncestorContainer)||(n=null)),n||(n=Q(e.firstElementChild||e,0)),n}setSelection(t){if(this._lastSelection=t,!this._isFocused)this._enableRestoreSelection();else{let e=window.getSelection();e&&("setBaseAndExtent"in Selection.prototype?e.setBaseAndExtent(t.startContainer,t.startOffset,t.endContainer,t.endOffset):(e.removeAllRanges(),e.addRange(t)))}return this}_moveCursorTo(t){let e=this._root,n=Q(e,t?0:e.childNodes.length);return C(n),this.setSelection(n),this}moveCursorToStart(){return this._moveCursorTo(!0)}moveCursorToEnd(){return this._moveCursorTo(!1)}getCursorPosition(){let t=this.getSelection(),e=t.getBoundingClientRect();if(e&&!e.top){this._ignoreChange=!0;let n=m("SPAN");n.textContent=B,G(t,n),e=n.getBoundingClientRect();let o=n.parentNode;o.removeChild(n),te(o,t)}return e}getPath(){return this._path}_updatePathOnEvent(){this._isFocused&&this._updatePath(this.getSelection())}_updatePath(t,e){let n=t.startContainer,o=t.endContainer,s;(e||n!==this._lastAnchorNode||o!==this._lastFocusNode)&&(this._lastAnchorNode=n,this._lastFocusNode=o,s=n&&o?n===o?this._getPath(o):"(selection)":"",(this._path!==s||n!==o)&&(this._path=s,this.fireEvent("pathChange",{path:s}))),this.fireEvent(t.collapsed?"cursor":"select",{range:t})}_getPath(t){let e=this._root,n=this._config,o="";if(t&&t!==e){let s=t.parentNode;if(o=s?this._getPath(s):"",t instanceof HTMLElement){let r=t.id,l=t.classList,a=Array.from(l).sort(),d=t.dir,c=n.classNames;o+=(o?">":"")+t.nodeName,r&&(o+="#"+r),a.length&&(o+=".",o+=a.join(".")),d&&(o+="[dir="+d+"]"),l.contains(c.highlight)&&(o+="[backgroundColor="+t.style.backgroundColor.replace(/ /g,"")+"]"),l.contains(c.color)&&(o+="[color="+t.style.color.replace(/ /g,"")+"]"),l.contains(c.fontFamily)&&(o+="[fontFamily="+t.style.fontFamily.replace(/ /g,"")+"]"),l.contains(c.fontSize)&&(o+="[fontSize="+t.style.fontSize+"]")}}return o}modifyDocument(t){let e=this._mutation;return e&&(e.takeRecords().length&&this._docWasChanged(),e.disconnect()),this._ignoreAllChanges=!0,t(),this._ignoreAllChanges=!1,e&&(e.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1),this}_docWasChanged(){if(Ke(),this._mayHaveZWS=!0,!this._ignoreAllChanges){if(this._ignoreChange){this._ignoreChange=!1;return}this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")}}_recordUndoState(t,e){let n=this._isInUndoState;if(!n||e){let o=this._undoIndex+1,s=this._undoStack,r=this._config.undo,l=r.documentSizeThreshold,a=r.undoLimit;if(o<this._undoStackLength&&(s.length=this._undoStackLength=o),t&&this._saveRangeToBookmark(t),n)return this;let d=this._getRawHTML();e&&(o-=1),l>-1&&d.length*2>l&&a>-1&&o>a&&(s.splice(0,o-a),o=a,this._undoStackLength=a),s[o]=d,this._undoIndex=o,this._undoStackLength+=1,this._isInUndoState=!0}return this}saveUndoState(t){let e=!1;return t||(t=this.getSelection(),e=!0),this._recordUndoState(t,this._isInUndoState),this._getRangeAndRemoveBookmark(t),e&&this.setSelection(t),this}undo(){if(this._undoIndex!==0||!this._isInUndoState){this._recordUndoState(this.getSelection(),!1),this._undoIndex-=1,this._setRawHTML(this._undoStack[this._undoIndex]);let t=this._getRangeAndRemoveBookmark();t&&this.setSelection(t),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:this._undoIndex!==0,canRedo:!0}),this.fireEvent("input")}return this.focus()}redo(){let t=this._undoIndex,e=this._undoStackLength;if(t+1<e&&this._isInUndoState){this._undoIndex+=1,this._setRawHTML(this._undoStack[this._undoIndex]);let n=this._getRangeAndRemoveBookmark();n&&this.setSelection(n),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:t+2<e}),this.fireEvent("input")}return this.focus()}getRoot(){return this._root}_getRawHTML(){return this._root.innerHTML}_setRawHTML(t){let e=this._root;e.innerHTML=t;let n=e,o=n.firstChild;if(!o||o.nodeName==="BR"){let s=this.createDefaultBlock();o?n.replaceChild(s,o):n.appendChild(s)}else for(;n=H(n,e);)x(n);return this._ignoreChange=!0,this}getHTML(t){let e,n="";return this.modifyDocument(()=>{t&&(e=this.getSelection(),this._saveRangeToBookmark(e));let o=this._root.querySelector(".squire-image-resize-container");o&&o.remove(),n=this._getRawHTML().replace(/\u200B/g,""),o&&this._root.appendChild(o),t&&this._getRangeAndRemoveBookmark(e)}),n}setHTML(t){let e=this._config.sanitizeToDOMFragment(t,this),n=this._root;Ne(e,this._config),le(e,n,!1),w(e,n);let o=e,s=o.firstChild;if(!s||s.nodeName==="BR"){let l=this.createDefaultBlock();s?o.replaceChild(l,s):o.appendChild(l)}else for(;o=H(o,n);)x(o);for(this._ignoreChange=!0;s=n.lastChild;)n.removeChild(s);n.appendChild(e),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;let r=this._getRangeAndRemoveBookmark()||Q(n.firstElementChild||n,0);return this.saveUndoState(r),this.setSelection(r),this._updatePath(r,!0),this}insertHTML(t,e){let n=this._config,o=n.sanitizeToDOMFragment(t,this),s=this.getSelection();this.saveUndoState(s);try{let r=this._root;n.addLinks&&this.addDetectedLinks(o,o),Ne(o,this._config),le(o,r,!1),ge(o),o.normalize();let l=o;for(;l=H(l,o);)x(l);let a=!0;if(e){let d=new CustomEvent("willPaste",{cancelable:!0,detail:{html:t,fragment:o}});this.fireEvent("willPaste",d),o=d.detail.fragment,a=!d.defaultPrevented}a&&(je(s,o,r),s.collapse(!1),ye(s,"A",r),this._ensureBottomLine()),this.setSelection(s),this._updatePath(s,!0),e&&this.focus()}catch(r){this._config.didError(r)}return this}insertElement(t,e){if(e||(e=this.getSelection()),e.collapse(!0),N(t))G(e,t),e.setStartAfter(t);else{let n=this._root,o=v(e,n),s=o||n,r=null;for(;s!==n&&!s.nextSibling;)s=s.parentNode;if(s!==n){let a=s.parentNode;r=I(a,s.nextSibling,n,n)}o&&ce(o)&&E(o),n.insertBefore(t,r);let l=this.createDefaultBlock();n.insertBefore(l,r),e.setStart(l,0),e.setEnd(l,0),C(e)}return this.focus(),this.setSelection(e),this._updatePath(e),this}insertImage(t,e){let n=m("IMG",Object.assign({src:t},e));return this.insertElement(n),n}insertPlainText(t,e){let n=this.getSelection();if(n.collapsed&&g(n.startContainer,this._root,"PRE")){let c=n.startContainer,u=n.startOffset,f;if(!c||!(c instanceof Text)){let h=document.createTextNode("");c.insertBefore(h,c.childNodes[u]),f=h,u=0}else f=c;let p=!0;if(e){let h=new CustomEvent("willPaste",{cancelable:!0,detail:{text:t}});this.fireEvent("willPaste",h),t=h.detail.text,p=!h.defaultPrevented}return p&&(f.insertData(u,t),n.setStart(f,u+t.length),n.collapse(!0)),this.setSelection(n),this}let o=t.split(`
`),s=this._config,r=s.blockTag,l=s.blockAttributes,a="</"+r+">",d="<"+r;for(let c in l)d+=" "+c+'="'+Oe(l[c])+'"';d+=">";for(let c=0,u=o.length;c<u;c+=1){let f=o[c];f=Oe(f).replace(/ (?=(?: |$))/g,"&nbsp;"),c&&(f=d+(f||"<BR>")+a),o[c]=f}return this.insertHTML(o.join(""),e)}getSelectedText(t){return Se(t||this.getSelection())}getFontInfo(t){let e={color:void 0,backgroundColor:void 0,fontFamily:void 0,fontSize:void 0};t||(t=this.getSelection()),C(t);let n=0,o=t.commonAncestorContainer;if(t.collapsed||o instanceof Text)for(o instanceof Text&&(o=o.parentNode);n<4&&o;){let s=o.style;if(s){let r=s.color;!e.color&&r&&(e.color=r,n+=1);let l=s.backgroundColor;!e.backgroundColor&&l&&(e.backgroundColor=l,n+=1);let a=s.fontFamily;!e.fontFamily&&a&&(e.fontFamily=a,n+=1);let d=s.fontSize;!e.fontSize&&d&&(e.fontSize=d,n+=1)}o=o.parentNode}return e}hasFormat(t,e,n){t=t.toUpperCase(),e||(e={}),n||(n=this.getSelection()),!n.collapsed&&n.startContainer instanceof Text&&n.startOffset===n.startContainer.length&&n.startContainer.nextSibling&&n.setStartBefore(n.startContainer.nextSibling),!n.collapsed&&n.endContainer instanceof Text&&n.endOffset===0&&n.endContainer.previousSibling&&n.setEndAfter(n.endContainer.previousSibling);let o=this._root,s=n.commonAncestorContainer;if(g(s,o,t,e))return!0;if(s instanceof Text)return!1;let r=new _(s,4,d=>z(n,d,!0)),l=!1,a;for(;a=r.nextNode();){if(!g(a,o,t,e))return!1;l=!0}return l}changeFormat(t,e,n,o){return n||(n=this.getSelection()),this.saveUndoState(n),e&&(n=this._removeFormat(e.tag.toUpperCase(),e.attributes||{},n,o)),t&&(n=this._addFormat(t.tag.toUpperCase(),t.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0),this.focus()}_addFormat(t,e,n){let o=this._root;if(n.collapsed){let s=x(m(t,e));G(n,s);let r=s.firstChild||s,l=r instanceof Text?r.length:0;n.setStart(r,l),n.collapse(!0);let a=s;for(;N(a);)a=a.parentNode;re(a,s)}else{let s=new _(n.commonAncestorContainer,5,c=>(c instanceof Text||c.nodeName==="BR"||c.nodeName==="IMG")&&z(n,c,!0)),{startContainer:r,startOffset:l,endContainer:a,endOffset:d}=n;if(s.currentNode=r,!(r instanceof Element)&&!(r instanceof Text)||!s.filter(r)){let c=s.nextNode();if(!c)return n;r=c,l=0}do{let c=s.currentNode;if(!g(c,o,t,e)){c===a&&c.length>d&&c.splitText(d),c===r&&l&&(c=c.splitText(l),a===r?(a=c,d-=l):a===r.parentNode&&(d+=1),r=c,l=0);let f=m(t,e);k(c,f),f.appendChild(c)}}while(s.nextNode());n=Q(r,l,a,d)}return n}_removeFormat(t,e,n,o){this._saveRangeToBookmark(n);let s;n.collapsed&&(ie?s=document.createTextNode(B):s=document.createTextNode(""),G(n,s));let r=n.commonAncestorContainer;for(;N(r);)r=r.parentNode;let l=n.startContainer,a=n.startOffset,d=n.endContainer,c=n.endOffset,u=[],f=(h,S)=>{if(z(n,h,!1))return;let L,R;if(!z(n,h,!0)){!(h instanceof HTMLInputElement)&&(!(h instanceof Text)||h.data)&&u.push([S,h]);return}if(h instanceof Text)h===d&&c!==h.length&&u.push([S,h.splitText(c)]),h===l&&a&&(h.splitText(a),u.push([S,h]));else for(L=h.firstChild;L;L=R)R=L.nextSibling,f(L,S)},p=Array.from(r.getElementsByTagName(t)).filter(h=>z(n,h,!0)&&he(h,t,e));if(o||p.forEach(h=>{f(h,h)}),u.forEach(([h,S])=>{h=h.cloneNode(!1),k(S,h),h.appendChild(S)}),p.forEach(h=>{k(h,T(h))}),ie&&s){s=s.parentNode;let h=s;for(;h&&N(h);)h=h.parentNode;h&&re(h,s)}return this._getRangeAndRemoveBookmark(n),s&&n.collapse(!1),te(r,n),n}bold(){return this.changeFormat({tag:"B"})}removeBold(){return this.changeFormat(null,{tag:"B"})}italic(){return this.changeFormat({tag:"I"})}removeItalic(){return this.changeFormat(null,{tag:"I"})}underline(){return this.changeFormat({tag:"U"})}removeUnderline(){return this.changeFormat(null,{tag:"U"})}strikethrough(){return this.changeFormat({tag:"S"})}removeStrikethrough(){return this.changeFormat(null,{tag:"S"})}subscript(){return this.changeFormat({tag:"SUB"},{tag:"SUP"})}removeSubscript(){return this.changeFormat(null,{tag:"SUB"})}superscript(){return this.changeFormat({tag:"SUP"},{tag:"SUB"})}removeSuperscript(){return this.changeFormat(null,{tag:"SUP"})}makeLink(t,e){let n=this.getSelection();if(n.collapsed){let o=t.indexOf(":")+1;if(o)for(;t[o]==="/";)o+=1;G(n,document.createTextNode(t.slice(o)))}return e=Object.assign({href:t},this._config.tagAttributes.a,e),this.changeFormat({tag:"A",attributes:e},{tag:"A"},n)}removeLink(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0)}addDetectedLinks(t,e){let n=new _(t,4,l=>!g(l,e||this._root,"A")),o=this.linkRegExp,s=this._config.tagAttributes.a,r;for(;r=n.nextNode();){let l=r.parentNode,a=r.data,d;for(;d=o.exec(a);){let c=d.index,u=c+d[0].length;c&&l.insertBefore(document.createTextNode(a.slice(0,c)),r);let f=m("A",Object.assign({href:d[1]?/^(?:ht|f)tps?:/i.test(d[1])?d[1]:"http://"+d[1]:"mailto:"+d[0]},s));f.textContent=a.slice(c,u),l.insertBefore(f,r),r.data=a=a.slice(u)}}return this}setFontFace(t){let e=this._config.classNames.fontFamily;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"font-family: "+t+", sans-serif;"}}:null,{tag:"SPAN",attributes:{class:e}})}setFontSize(t){let e=this._config.classNames.fontSize;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"font-size: "+(typeof t=="number"?t+"px":t)}}:null,{tag:"SPAN",attributes:{class:e}})}setTextColor(t){let e=this._config.classNames.color;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"color:"+t}}:null,{tag:"SPAN",attributes:{class:e}})}setHighlightColor(t){let e=this._config.classNames.highlight;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"background-color:"+t}}:null,{tag:"SPAN",attributes:{class:e}})}_ensureBottomLine(){let t=this._root,e=t.lastElementChild;(!e||e.nodeName!==this._config.blockTag||!q(e))&&t.appendChild(this.createDefaultBlock())}createDefaultBlock(t){let e=this._config;return x(m(e.blockTag,e.blockAttributes,t))}splitBlock(t,e){e||(e=this.getSelection());let n=this._root,o,s,r,l;if(this._recordUndoState(e),this._removeZWS(),this._getRangeAndRemoveBookmark(e),e.collapsed||F(e,n),this._config.addLinks){C(e);let f=e.startContainer,p=e.startOffset;setTimeout(()=>{Te(this,f,p)},0)}if(o=v(e,n),o&&(s=g(o,n,"PRE"))){C(e),r=e.startContainer;let f=e.startOffset;return r instanceof Text||(r=document.createTextNode(""),s.insertBefore(r,s.firstChild)),!t&&r instanceof Text&&(r.data.charAt(f-1)===`
`||j(e,n))&&(r.data.charAt(f)===`
`||Z(e,n))?(r.deleteData(f&&f-1,f?2:1),l=I(r,f&&f-1,n,n),r=l.previousSibling,r.textContent||E(r),r=this.createDefaultBlock(),l.parentNode.insertBefore(r,l),l.textContent||E(l),e.setStart(r,0)):(r.insertData(f,`
`),r.nextSibling||s.appendChild(m("BR")),r.length===f+1?e.setStartAfter(r):e.setStart(r,f+1)),e.collapse(!0),this.setSelection(e),this._updatePath(e,!0),this._docWasChanged(),this}if(!o||t||/^T[HD]$/.test(o.nodeName))return ye(e,"A",n),G(e,m("BR")),e.collapse(!1),this.setSelection(e),this._updatePath(e,!0),this;if((s=g(o,n,"LI"))&&(o=s),ce(o)){if(g(o,n,"UL")||g(o,n,"OL"))return this.decreaseListLevel(e),this;if(g(o,n,"BLOCKQUOTE"))return this.replaceWithBlankLine(e),this}r=e.startContainer;let a=e.startOffset,d=this.tagAfterSplit[o.nodeName];l=I(r,a,o.parentNode,this._root);let c=this._config,u=null;for(d||(d=c.blockTag,u=c.blockAttributes),he(l,d,u)||(o=m(d,u),l.dir&&(o.dir=l.dir),k(l,o),o.appendChild(T(l)),l=o),re(o),ge(o),x(o);l instanceof Element;){let f=l.firstChild,p;if(l.nodeName==="A"&&(!l.textContent||l.textContent===B)){f=document.createTextNode(""),k(l,f),l=f;break}for(;f&&f instanceof Text&&!f.data&&(p=f.nextSibling,!(!p||p.nodeName==="BR"));)E(f),f=p;if(!f||f.nodeName==="BR"||f instanceof Text)break;l=f}return e=Q(l,0),this.setSelection(e),this._updatePath(e,!0),this}forEachBlock(t,e,n){n||(n=this.getSelection()),e&&this.saveUndoState(n);let o=this._root,s=v(n,o),r=$(n,o);if(s&&r)do if(t(s)||s===r)break;while(s=H(s,o));return e&&(this.setSelection(n),this._updatePath(n,!0)),this}modifyBlocks(t,e){e||(e=this.getSelection()),this._recordUndoState(e,this._isInUndoState);let n=this._root;Be(e,n),K(e,n,n,n);let o=De(e,n,n);if(!e.collapsed){let s=e.endContainer;if(s===n)e.collapse(!1);else{for(;s.parentNode!==n;)s=s.parentNode;e.setStartBefore(s),e.collapse(!0)}}return G(e,t.call(this,o)),e.endOffset<e.endContainer.childNodes.length&&P(e.endContainer.childNodes[e.endOffset],n),P(e.startContainer.childNodes[e.startOffset],n),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),this}setTextAlignment(t){return this.forEachBlock(e=>{let n=e.className.split(/\s+/).filter(o=>!!o&&!/^align/.test(o)).join(" ");t?(e.className=n+" align-"+t,e.style.textAlign=t):(e.className=n,e.style.textAlign="")},!0),this.focus()}setTextDirection(t){return this.forEachBlock(e=>{t?e.dir=t:e.removeAttribute("dir")},!0),this.focus()}_getListSelection(t,e){let n=t.commonAncestorContainer,o=t.startContainer,s=t.endContainer;for(;n&&n!==e&&!/^[OU]L$/.test(n.nodeName);)n=n.parentNode;if(!n||n===e)return null;for(o===n&&(o=o.childNodes[t.startOffset]),s===n&&(s=s.childNodes[t.endOffset]);o&&o.parentNode!==n;)o=o.parentNode;for(;s&&s.parentNode!==n;)s=s.parentNode;return[n,o,s]}increaseListLevel(t){t||(t=this.getSelection());let e=this._root,n=this._getListSelection(t,e);if(!n)return this.focus();let[o,s,r]=n;if(!s||s===o.firstChild)return this.focus();this._recordUndoState(t,this._isInUndoState);let l=o.nodeName,a=s.previousSibling,d,c;a.nodeName!==l&&(d=this._config.tagAttributes[l.toLowerCase()],a=m(l,d),o.insertBefore(a,s));do c=s===r?null:s.nextSibling,a.appendChild(s);while(s=c);return c=a.nextSibling,c&&P(c,e),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}decreaseListLevel(t){t||(t=this.getSelection());let e=this._root,n=this._getListSelection(t,e);if(!n)return this.focus();let[o,s,r]=n;s||(s=o.firstChild),r||(r=o.lastChild),this._recordUndoState(t,this._isInUndoState);let l,a=null;if(s){let d=o.parentNode;if(a=r.nextSibling?I(o,r.nextSibling,d,e):o.nextSibling,d!==e&&d.nodeName==="LI"){for(d=d.parentNode;a;)l=a.nextSibling,r.appendChild(a),a=l;a=o.parentNode.nextSibling}let c=!/^[OU]L$/.test(d.nodeName);do l=s===r?null:s.nextSibling,o.removeChild(s),c&&s.nodeName==="LI"&&(s=this.createDefaultBlock([T(s)])),d.insertBefore(s,a);while(s=l)}return o.firstChild||E(o),a&&P(a,e),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}_makeList(t,e){let n=ae(t,this._root),o=this._config.tagAttributes,s=o[e.toLowerCase()],r=o.li,l;for(;l=n.nextNode();)if(l.parentNode instanceof HTMLLIElement&&(l=l.parentNode,n.currentNode=l.lastChild),l instanceof HTMLLIElement){l=l.parentNode;let a=l.nodeName;a!==e&&/^[OU]L$/.test(a)&&k(l,m(e,s,[T(l)]))}else{let a=m("LI",r);l.dir&&(a.dir=l.dir);let d=l.previousSibling;d&&d.nodeName===e?(d.appendChild(a),E(l)):k(l,m(e,s,[a])),a.appendChild(T(l)),n.currentNode=a}return t}makeUnorderedList(){return this.modifyBlocks(t=>this._makeList(t,"UL")),this.focus()}makeOrderedList(){return this.modifyBlocks(t=>this._makeList(t,"OL")),this.focus()}removeList(){return this.modifyBlocks(t=>{let e=t.querySelectorAll("UL, OL"),n=t.querySelectorAll("LI"),o=this._root;for(let s=0,r=e.length;s<r;s+=1){let l=e[s],a=T(l);w(a,o),k(l,a)}for(let s=0,r=n.length;s<r;s+=1){let l=n[s];q(l)?k(l,this.createDefaultBlock([T(l)])):(w(l,o),k(l,T(l)))}return t}),this.focus()}increaseQuoteLevel(t){return this.modifyBlocks(e=>m("BLOCKQUOTE",this._config.tagAttributes.blockquote,[e]),t),this.focus()}decreaseQuoteLevel(t){return this.modifyBlocks(e=>(Array.from(e.querySelectorAll("blockquote")).filter(n=>!g(n.parentNode,e,"BLOCKQUOTE")).forEach(n=>{k(n,T(n))}),e),t),this.focus()}removeQuote(t){return this.modifyBlocks(e=>(Array.from(e.querySelectorAll("blockquote")).forEach(n=>{k(n,T(n))}),e),t),this.focus()}replaceWithBlankLine(t){return this.modifyBlocks(()=>this.createDefaultBlock([m("INPUT",{id:this.startSelectionId,type:"hidden"}),m("INPUT",{id:this.endSelectionId,type:"hidden"})]),t),this.focus()}code(){let t=this.getSelection();return t.collapsed||X(t.commonAncestorContainer)?(this.modifyBlocks(e=>{let n=this._root,o=document.createDocumentFragment(),s=ae(e,n),r;for(;r=s.nextNode();){let a=r.querySelectorAll("BR"),d=[],c=a.length;for(let u=0;u<c;u+=1)d[u]=ee(a[u],!1);for(;c--;){let u=a[c];d[c]?k(u,document.createTextNode(`
`)):E(u)}for(a=r.querySelectorAll("CODE"),c=a.length;c--;)k(a[c],T(a[c]));o.childNodes.length&&o.appendChild(document.createTextNode(`
`)),o.appendChild(T(r))}let l=new _(o,4);for(;r=l.nextNode();)r.data=r.data.replace(/ /g," ");return o.normalize(),x(m("PRE",this._config.tagAttributes.pre,[o]))},t),this.focus()):this.changeFormat({tag:"CODE",attributes:this._config.tagAttributes.code},null,t),this}removeCode(){let t=this.getSelection(),e=t.commonAncestorContainer;return g(e,this._root,"PRE")?(this.modifyBlocks(o=>{let s=this._root,r=o.querySelectorAll("PRE"),l=r.length;for(;l--;){let a=r[l],d=new _(a,4),c;for(;c=d.nextNode();){let u=c.data;u=u.replace(/ (?= )/g,"\xA0");let f=document.createDocumentFragment(),p;for(;(p=u.indexOf(`
`))>-1;)f.appendChild(document.createTextNode(u.slice(0,p))),f.appendChild(m("BR")),u=u.slice(p+1);c.parentNode.insertBefore(f,c),c.data=u}w(a,s),k(a,T(a))}return o},t),this.focus()):this.changeFormat(null,{tag:"CODE"},t),this}toggleCode(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code(),this}_removeFormatting(t,e){for(let n=t.firstChild,o;n;n=o){if(o=n.nextSibling,N(n)){if(n instanceof Text||n.nodeName==="BR"||n.nodeName==="IMG"){e.appendChild(n);continue}}else if(q(n)){e.appendChild(this.createDefaultBlock([this._removeFormatting(n,document.createDocumentFragment())]));continue}this._removeFormatting(n,e)}return e}removeAllFormatting(t){if(t||(t=this.getSelection()),t.collapsed)return this.focus();let e=this._root,n=t.commonAncestorContainer;for(;n&&!q(n);)n=n.parentNode;if(n||(Be(t,e),n=e),n instanceof Text)return this.focus();this.saveUndoState(t),K(t,n,n,e);let o=t.startContainer,s=t.startOffset,r=t.endContainer,l=t.endOffset,a=document.createDocumentFragment(),d=document.createDocumentFragment(),c=I(r,l,n,e),u=I(o,s,n,e),f;for(;u!==c;)f=u.nextSibling,a.appendChild(u),u=f;if(this._removeFormatting(a,d),d.normalize(),u=d.firstChild,f=d.lastChild,u){n.insertBefore(d,c);let p=Array.from(n.childNodes);s=p.indexOf(u),l=f?p.indexOf(f)+1:0}else c&&(s=Array.from(n.childNodes).indexOf(c),l=s);return t.setStart(n,s),t.setEnd(n,l),te(n,t),C(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}};var $i=Ce;export{$i as default};
//# sourceMappingURL=squire.mjs.map
