var it=()=>!0,_=class{root;currentNode;nodeType;filter;constructor(t,e,n){this.root=t,this.currentNode=t,this.nodeType=e,this.filter=n||it}isAcceptableNode(t){let e=t.nodeType;return!!((e===Node.ELEMENT_NODE?1:e===Node.TEXT_NODE?4:0)&this.nodeType)&&this.filter(t)}nextNode(){let t=this.root,e=this.currentNode,n;for(;;){for(n=e.firstChild;!n&&e&&e!==t;)n=e.nextSibling,n||(e=e.parentNode);if(!n)return null;if(this.isAcceptableNode(n))return this.currentNode=n,n;e=n}}previousNode(){let t=this.root,e=this.currentNode,n;for(;;){if(e===t)return null;if(n=e.previousSibling,n)for(;e=n.lastChild;)n=e;else n=e.parentNode;if(!n)return null;if(this.isAcceptableNode(n))return this.currentNode=n,n;e=n}}previousPONode(){let t=this.root,e=this.currentNode,n;for(;;){for(n=e.lastChild;!n&&e&&e!==t;)n=e.previousSibling,n||(e=e.parentNode);if(!n)return null;if(this.isAcceptableNode(n))return this.currentNode=n,n;e=n}}};var W="\u200B",V=navigator.userAgent,ce=/Mac OS X/.test(V),de=/Windows NT/.test(V),Ce=/iP(?:ad|hone|od)/.test(V)||ce&&!!navigator.maxTouchPoints,Me=/Android/.test(V),Fe=/Gecko\//.test(V),se=/Edge\//.test(V),st=!se&&/WebKit\//.test(V),y=ce||Ce?"Meta-":"Ctrl-",re=st,He="onbeforeinput"in document&&"inputType"in new InputEvent("input"),w=/[^ \t\r\n]/;var at=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/,ct=new Set(["BR","HR","IFRAME","IMG","INPUT"]),dt=0,_e=1,Pe=2,Ue=3,fe=new WeakMap,qe=()=>{fe=new WeakMap},I=o=>ct.has(o.nodeName),ve=o=>{switch(o.nodeType){case 3:return _e;case 1:case 11:if(fe.has(o))return fe.get(o);break;default:return dt}let t;return Array.from(o.childNodes).every(N)?at.test(o.nodeName)?t=_e:t=Pe:t=Ue,fe.set(o,t),t},N=o=>ve(o)===_e,H=o=>ve(o)===Pe,j=o=>ve(o)===Ue;var m=(o,t,e)=>{let n=document.createElement(o);if(t instanceof Array&&(e=t,t=null),t)for(let i in t){let s=t[i];s!==void 0&&n.setAttribute(i,s)}return e&&e.forEach(i=>n.appendChild(i)),n},xe=(o,t)=>I(o)||o.nodeType!==t.nodeType||o.nodeName!==t.nodeName?!1:o instanceof HTMLElement&&t instanceof HTMLElement?o.nodeName!=="A"&&o.className===t.className&&o.style.cssText===t.style.cssText:!0,ue=(o,t,e)=>{if(o.nodeName!==t)return!1;for(let n in e)if(!("getAttribute"in o)||o.getAttribute(n)!==e[n])return!1;return!0},g=(o,t,e,n)=>{for(;o&&o!==t;){if(ue(o,e,n))return o;o=o.parentNode}return null},he=(o,t)=>{let e=o.childNodes;for(;t&&o instanceof Element;)o=e[t-1],e=o.childNodes,t=e.length;return o},Le=(o,t)=>{let e=o;if(e instanceof Element){let n=e.childNodes;if(t<n.length)e=n[t];else{for(;e&&!e.nextSibling;)e=e.parentNode;e&&(e=e.nextSibling)}}return e},k=o=>o instanceof Element||o instanceof DocumentFragment?o.childNodes.length:o instanceof CharacterData?o.length:0,S=o=>{let t=document.createDocumentFragment(),e=o.firstChild;for(;e;)t.appendChild(e),e=o.firstChild;return t},E=o=>{let t=o.parentNode;return t&&t.removeChild(o),o},L=(o,t)=>{let e=o.parentNode;e&&e.replaceChild(t,o)};var ft=o=>o instanceof Element?o.nodeName==="BR":w.test(o.data),Y=(o,t)=>{let e=o.parentNode;for(;N(e);)e=e.parentNode;let n=new _(e,5,ft);return n.currentNode=o,!!n.nextNode()||t&&!n.previousNode()},me=(o,t)=>{let e=new _(o,4),n,i;for(;n=e.nextNode();)for(;(i=n.data.indexOf(W))>-1&&(!t||n.parentNode!==t);)if(n.length===1){let s=n,r=s.parentNode;for(;r&&(r.removeChild(s),e.currentNode=r,!(!N(r)||k(r)));)s=r,r=s.parentNode;break}else n.deleteData(i,1)};var ut=0,ht=1,mt=2,pt=3,K=(o,t,e)=>{let n=document.createRange();if(n.selectNode(t),e){let i=o.compareBoundaryPoints(pt,n)>-1,s=o.compareBoundaryPoints(ht,n)<1;return!i&&!s}else{let i=o.compareBoundaryPoints(ut,n)<1,s=o.compareBoundaryPoints(mt,n)>-1;return i&&s}},C=o=>{let{startContainer:t,startOffset:e,endContainer:n,endOffset:i}=o;for(;!(t instanceof Text);){let s=t.childNodes[e];if(!s||I(s)){if(e){s=t.childNodes[e-1];let r=s.previousSibling;for(;s instanceof Text&&!s.length&&r&&r instanceof Text;)s.remove(),s=r;s instanceof Text&&(t=s,e=s.data.length)}break}t=s,e=0}if(i)for(;!(n instanceof Text);){let s=n.childNodes[i-1];if(!s||I(s)){if(s&&s.nodeName==="BR"&&!Y(s,!1)){i-=1;continue}break}n=s,i=k(n)}else for(;!(n instanceof Text);){let s=n.firstChild;if(!s||I(s))break;n=s}o.setStart(t,e),o.setEnd(n,i)},P=(o,t,e,n)=>{let i=o.startContainer,s=o.startOffset,r=o.endContainer,l=o.endOffset,a;for(t||(t=o.commonAncestorContainer),e||(e=t);!s&&i!==t&&i!==n;)a=i.parentNode,s=Array.from(a.childNodes).indexOf(i),i=a;for(;!(r===e||r===n||(r.nodeType!==3&&r.childNodes[l]&&r.childNodes[l].nodeName==="BR"&&!Y(r.childNodes[l],!1)&&(l+=1),l!==k(r)));)a=r.parentNode,l=Array.from(a.childNodes).indexOf(r)+1,r=a;o.setStart(i,s),o.setEnd(r,l)},Re=(o,t,e)=>{let n=g(o.endContainer,e,t);if(n&&(n=n.parentNode)){let i=o.cloneRange();P(i,n,n,e),i.endContainer===n&&(o.setStart(i.endContainer,i.endOffset),o.setEnd(i.endContainer,i.endOffset))}return o};var b=o=>{let t=null;if(o instanceof Text)return o;if(N(o)){let e=o.firstChild;if(re)for(;e&&e instanceof Text&&!e.data;)o.removeChild(e),e=o.firstChild;e||(re?t=document.createTextNode(W):t=document.createTextNode(""))}else if(o instanceof Element&&!o.querySelector("BR")){t=m("BR");let e=o,n;for(;(n=e.lastElementChild)&&!N(n);)e=n}if(t)try{o.appendChild(t)}catch{}return o},B=(o,t)=>{let e=null;return[...o.childNodes].forEach(n=>{let i=n.nodeName==="BR";!i&&N(n)?(e||(e=m("DIV")),e.appendChild(n)):(i||e)&&(e||(e=m("DIV")),b(e),i?o.replaceChild(e,n):o.insertBefore(e,n),e=null),j(n)&&B(n,t)}),e&&o.appendChild(b(e)),o},A=(o,t,e,n)=>{if(o instanceof Text&&o!==e){if(typeof t!="number")throw new Error("Offset must be a number to split text node!");if(!o.parentNode)throw new Error("Cannot split text node with no parent!");return A(o.parentNode,o.splitText(t),e,n)}let i=typeof t=="number"?t<o.childNodes.length?o.childNodes[t]:null:t,s=o.parentNode;if(!s||o===e||!(o instanceof Element))return i;let r=o.cloneNode(!1);for(;i;){let l=i.nextSibling;r.appendChild(i),i=l}return o instanceof HTMLOListElement&&g(o,n,"BLOCKQUOTE")&&(r.start=(+o.start||1)+o.childNodes.length-1),b(o),b(r),s.insertBefore(r,o.nextSibling),A(s,r,e,n)},We=(o,t)=>{let e=o.childNodes,n=e.length,i=[];for(;n--;){let s=e[n],r=n?e[n-1]:null;if(r&&N(s)&&xe(s,r))t.startContainer===s&&(t.startContainer=r,t.startOffset+=k(r)),t.endContainer===s&&(t.endContainer=r,t.endOffset+=k(r)),t.startContainer===o&&(t.startOffset>n?t.startOffset-=1:t.startOffset===n&&(t.startContainer=r,t.startOffset=k(r))),t.endContainer===o&&(t.endOffset>n?t.endOffset-=1:t.endOffset===n&&(t.endContainer=r,t.endOffset=k(r))),E(s),s instanceof Text?r.appendData(s.data):i.push(S(s));else if(s instanceof Element){let l;for(;l=i.pop();)s.appendChild(l);We(s,t)}}},J=(o,t)=>{let e=o instanceof Text?o.parentNode:o;if(e instanceof Element){let n={startContainer:t.startContainer,startOffset:t.startOffset,endContainer:t.endContainer,endOffset:t.endOffset};We(e,n),t.setStart(n.startContainer,n.startOffset),t.setEnd(n.endContainer,n.endOffset)}},$=(o,t,e,n)=>{let i=t,s,r;for(;(s=i.parentNode)&&s!==n&&s instanceof Element&&s.childNodes.length===1;)i=s;E(i),r=o.childNodes.length;let l=o.lastChild;l&&l.nodeName==="BR"&&(o.removeChild(l),r-=1),o.appendChild(S(t)),e.setStart(o,r),e.collapse(!0),J(o,e)},M=(o,t)=>{let e=o.previousSibling,n=o.firstChild,i=o.nodeName==="LI";if(!(i&&(!n||!/^[OU]L$/.test(n.nodeName)))){if(e&&xe(e,o)){if(!j(e))if(i){let r=m("DIV");r.appendChild(S(e)),e.appendChild(r)}else return;E(o);let s=!j(o);e.appendChild(S(o)),s&&B(e,t),n&&M(n,t)}else if(i){let s=m("DIV");o.insertBefore(s,n),b(s)}}};var Ke={"font-weight":{regexp:/^bold|^700/i,replace(){return m("B")}},"font-style":{regexp:/^italic/i,replace(){return m("I")}},"font-family":{regexp:w,replace(o,t){return m("SPAN",{class:o.fontFamily,style:"font-family:"+t})}},"font-size":{regexp:w,replace(o,t){return m("SPAN",{class:o.fontSize,style:"font-size:"+t})}},"text-decoration":{regexp:/^underline/i,replace(){return m("U")}}},Nt=(o,t,e)=>{let n=o.style,i,s;for(let r in Ke){let l=Ke[r],a=n.getPropertyValue(r);if(a&&l.regexp.test(a)){let d=l.replace(e.classNames,a);if(d.nodeName===o.nodeName&&d.className===o.className)continue;s||(s=d),i&&i.appendChild(d),i=d,o.style.removeProperty(r)}}return s&&i&&(i.appendChild(S(o)),o.style.cssText?o.appendChild(s):L(o,s)),i||o},pe=o=>(t,e)=>{let n=m(o),i=t.attributes;for(let s=0,r=i.length;s<r;s+=1){let l=i[s];n.setAttribute(l.name,l.value)}return e.replaceChild(n,t),n.appendChild(S(t)),n},gt={1:"10",2:"13",3:"16",4:"18",5:"24",6:"32",7:"48"},St={STRONG:pe("B"),EM:pe("I"),INS:pe("U"),STRIKE:pe("S"),SPAN:Nt,FONT:(o,t,e)=>{let n=o,i=n.face,s=n.size,r=n.color,l=e.classNames,a,d,c,f,u;return i&&(a=m("SPAN",{class:l.fontFamily,style:"font-family:"+i}),u=a,f=a),s&&(d=m("SPAN",{class:l.fontSize,style:"font-size:"+gt[s]+"px"}),u||(u=d),f&&f.appendChild(d),f=d),r&&/^#?([\dA-F]{3}){1,2}$/i.test(r)&&(r.charAt(0)!=="#"&&(r="#"+r),c=m("SPAN",{class:l.color,style:"color:"+r}),u||(u=c),f&&f.appendChild(c),f=c),(!u||!f)&&(u=f=m("SPAN")),t.replaceChild(u,n),f.appendChild(S(n)),f},TT:(o,t,e)=>{let n=m("SPAN",{class:e.classNames.fontFamily,style:'font-family:menlo,consolas,"courier new",monospace'});return t.replaceChild(n,o),n.appendChild(S(o)),n}},Et=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/,Tt=/^(?:HEAD|META|STYLE)/,Ne=(o,t,e)=>{let n=o.childNodes,i=o;for(;N(i);)i=i.parentNode;let s=new _(i,5);for(let r=0,l=n.length;r<l;r+=1){let a=n[r],d=a.nodeName,c=St[d];if(a instanceof HTMLElement){let f=a.childNodes.length;if(c)a=c(a,o,t);else if(Tt.test(d)){o.removeChild(a),r-=1,l-=1;continue}else if(!Et.test(d)&&!N(a)){r-=1,l+=f-1,o.replaceChild(S(a),a);continue}f&&Ne(a,t,e||d==="PRE")}else{if(a instanceof Text){let f=a.data,u=!w.test(f.charAt(0)),p=!w.test(f.charAt(f.length-1));if(e||!u&&!p)continue;if(u){s.currentNode=a;let h;for(;(h=s.previousPONode())&&!(h.nodeName==="IMG"||h instanceof Text&&w.test(h.data));)if(!N(h)){h=null;break}f=f.replace(/^[ \t\r\n]+/g,h?" ":"")}if(p){s.currentNode=a;let h;for(;(h=s.nextNode())&&!(h.nodeName==="IMG"||h instanceof Text&&w.test(h.data));)if(!N(h)){h=null;break}f=f.replace(/[ \t\r\n]+$/g,h?" ":"")}if(f){a.data=f;continue}}o.removeChild(a),r-=1,l-=1}}return o},ge=o=>{let t=o.childNodes,e=t.length;for(;e--;){let n=t[e];n instanceof Element&&!I(n)?(ge(n),N(n)&&!n.firstChild&&o.removeChild(n)):n instanceof Text&&!n.data&&o.removeChild(n)}},ee=(o,t,e)=>{let n=o.querySelectorAll("BR"),i=[],s=n.length;for(let r=0;r<s;r+=1)i[r]=Y(n[r],e);for(;s--;){let r=n[s],l=r.parentNode;l&&(i[s]?N(l)||B(l,t):E(r))}},Oe=o=>o.split("&").join("&amp;").split("<").join("&lt;").split(">").join("&gt;").split('"').join("&quot;");var le=(o,t)=>{let e=new _(t,1,H);return e.currentNode=o,e},z=(o,t)=>{let e=le(o,t).previousNode();return e!==t?e:null},U=(o,t)=>{let e=le(o,t).nextNode();return e!==t?e:null},ae=o=>!o.textContent&&!o.querySelector("IMG");var R=(o,t)=>{let e=o.startContainer,n;if(N(e))n=z(e,t);else if(e!==t&&e instanceof HTMLElement&&H(e))n=e;else{let i=he(e,o.startOffset);n=U(i,t)}return n&&K(o,n,!0)?n:null},G=(o,t)=>{let e=o.endContainer,n;if(N(e))n=z(e,t);else if(e!==t&&e instanceof HTMLElement&&H(e))n=e;else{let i=Le(e,o.endOffset);if(!i||!t.contains(i)){i=t;let s;for(;s=i.lastChild;)i=s}n=z(i,t)}return n&&K(o,n,!0)?n:null},ze=o=>o instanceof Text?w.test(o.data):o.nodeName==="IMG",Q=(o,t)=>{let e=o.startContainer,n=o.startOffset,i;if(e instanceof Text){if(n)return!1;i=e}else if(i=Le(e,n),i&&!t.contains(i)&&(i=null),!i&&(i=he(e,n),i instanceof Text&&i.length))return!1;let s=R(o,t);if(!s)return!1;let r=new _(s,5,ze);return r.currentNode=i,!r.previousNode()},oe=(o,t)=>{let e=o.endContainer,n=o.endOffset,i;if(e instanceof Text){let l=e.data.length;if(l&&n<l)return!1;i=e}else i=he(e,n);let s=G(o,t);if(!s)return!1;let r=new _(s,5,ze);return r.currentNode=i,!r.nextNode()},ke=(o,t)=>{let e=R(o,t),n=G(o,t),i;e&&n&&(i=e.parentNode,o.setStart(i,Array.from(i.childNodes).indexOf(e)),i=n.parentNode,o.setEnd(i,Array.from(i.childNodes).indexOf(n)+1))};function X(o,t,e,n){let i=document.createRange();return i.setStart(o,t),e&&typeof n=="number"?i.setEnd(e,n):i.setEnd(o,t),i}var Z=(o,t)=>{let{startContainer:e,startOffset:n,endContainer:i,endOffset:s}=o,r;if(e instanceof Text){let a=e.parentNode;if(r=a.childNodes,n===e.length)n=Array.from(r).indexOf(e)+1,o.collapsed&&(i=a,s=n);else{if(n){let d=e.splitText(n);i===e?(s-=n,i=d):i===a&&(s+=1),e=d}n=Array.from(r).indexOf(e)}e=a}else r=e.childNodes;let l=r.length;n===l?e.appendChild(t):e.insertBefore(t,r[n]),e===i&&(s+=r.length-l),o.setStart(e,n),o.setEnd(i,s)},ye=(o,t,e)=>{let n=document.createDocumentFragment();if(o.collapsed)return n;t||(t=o.commonAncestorContainer),t instanceof Text&&(t=t.parentNode);let i=o.startContainer,s=o.startOffset,r=A(o.endContainer,o.endOffset,t,e),l=0,a=A(i,s,t,e);for(;a&&a!==r;){let d=a.nextSibling;n.appendChild(a),a=d}return i instanceof Text&&r instanceof Text&&(i.appendData(r.data),E(r),r=i,l=s),o.setStart(i,s),r?o.setEnd(r,l):o.setEnd(t,t.childNodes.length),b(t),n},Ge=(o,t,e)=>{o.currentNode=e;let n;for(;n=o[t]();){if(n instanceof Text||I(n))return n;if(!N(n))return null}return null},F=(o,t)=>{let e=R(o,t),n=G(o,t),i=e!==n;e&&n&&(C(o),P(o,e,n,t));let s=ye(o,null,t);C(o),i&&(n=G(o,t),e&&n&&e!==n&&$(e,n,o,t)),e&&b(e);let r=t.firstChild;(!r||r.nodeName==="BR")&&(b(t),t.firstChild&&o.selectNodeContents(t.firstChild)),o.collapse(!0);let l=o.startContainer,a=o.startOffset,d=new _(t,5),c=l,f=a;(!(c instanceof Text)||f===c.data.length)&&(c=Ge(d,"nextNode",c),f=0);let u=l,p=a-1;(!(u instanceof Text)||p===-1)&&(u=Ge(d,"previousPONode",c||(l instanceof Text?l:l.childNodes[a]||l)),u instanceof Text&&(p=u.data.length));let h=null,T=0;return c instanceof Text&&c.data.charAt(f)===" "&&Q(o,t)?(h=c,T=f):u instanceof Text&&u.data.charAt(p)===" "&&(c instanceof Text&&c.data.charAt(f)===" "||oe(o,t))&&(h=u,T=p),h&&h.replaceData(T,1,"\xA0"),o.setStart(l,a),o.collapse(!0),s},Ze=(o,t,e)=>{let n=t.firstChild&&N(t.firstChild),i;for(B(t,e),i=t;i=U(i,e);)b(i);o.collapsed||F(o,e),C(o),o.collapse(!1);let s=g(o.endContainer,e,"BLOCKQUOTE")||e,r=R(o,e),l=null,a=U(t,t),d=!n&&!!r&&ae(r);if(r&&a&&!d&&!g(a,t,"PRE")&&!g(a,t,"TABLE")){P(o,r,r,e),o.collapse(!0);let c=o.endContainer,f=o.endOffset;if(ee(r,e,!1),N(c)){let u=A(c,f,z(c,e)||e,e);c=u.parentNode,f=Array.from(c.childNodes).indexOf(u)}if(f!==k(c))for(l=document.createDocumentFragment();i=c.childNodes[f];)l.appendChild(i);$(c,a,o,e),f=Array.from(c.parentNode.childNodes).indexOf(c)+1,c=c.parentNode,o.setEnd(c,f)}if(k(t)){d&&r&&(o.setEndBefore(r),o.collapse(!1),E(r)),P(o,s,s,e);let c=A(o.endContainer,o.endOffset,s,e),f=c?c.previousSibling:s.lastChild;s.insertBefore(t,c),c?o.setEndBefore(c):o.setEnd(s,k(s)),r=G(o,e),C(o);let u=o.endContainer,p=o.endOffset;c&&j(c)&&M(c,e),c=f&&f.nextSibling,c&&j(c)&&M(c,e),o.setEnd(u,p)}if(l&&r){let c=o.cloneRange();$(r,l,c,e),o.setEnd(c.endContainer,c.endOffset)}C(o)};var Be=Array.prototype.indexOf,_t=(o,t,e,n,i,s)=>{let r=o.clipboardData,l=document.body,a=m("DIV"),d,c;t.childNodes.length===1&&t.childNodes[0]instanceof Text?(c=t.childNodes[0].data.replace(/ /g," "),s=!0):(a.appendChild(t),d=a.innerHTML,n&&(d=n(d))),c!==void 0||(i&&d!==void 0?c=i(d):(ee(a,e,!0),a.setAttribute("style","position:fixed;overflow:hidden;bottom:100%;right:100%;"),l.appendChild(a),c=a.innerText||a.textContent,c=c.replace(/ /g," "),l.removeChild(a))),de&&(c=c.replace(/\r?\n/g,`\r
`)),!s&&d&&c!==d&&r.setData("text/html",d),r.setData("text/plain",c),o.preventDefault()},je=(o,t,e,n,i,s,r)=>{if(!se&&o.clipboardData){let l=R(t,e),a=G(t,e),d=e;l===a&&l?.contains(t.commonAncestorContainer)&&(d=l);let c;n?c=F(t,e):(t=t.cloneRange(),C(t),P(t,d,d,e),c=t.cloneContents());let f=t.commonAncestorContainer;for(f instanceof Text&&(f=f.parentNode);f&&f!==d;){let u=f.cloneNode(!1);u.appendChild(c),c=u,f=f.parentNode}return _t(o,c,e,i,s,r),!0}return!1},Qe=function(o){let t=this.getSelection(),e=this._root;if(t.collapsed){o.preventDefault();return}this.saveUndoState(t),je(o,t,e,!0,this._config.willCutCopy,null,!1)||setTimeout(()=>{try{this._ensureBottomLine()}catch(i){this._config.didError(i)}},0),this.setSelection(t)},Xe=function(o){je(o,this.getSelection(),this._root,!1,this._config.willCutCopy,null,!1)},De=function(o){this._isShiftDown=o.shiftKey},$e=function(o){let t=o.clipboardData,e=t?.items,n=this._isShiftDown,i=!1,s=!1,r=null,l=null;if(e){let v=e.length;for(;v--;){let O=e[v],D=O.type;D==="text/html"?l=O:D==="text/plain"||D==="text/uri-list"?r=O:D==="text/rtf"?i=!0:/^image\/.*/.test(D)&&(s=!0)}if(s&&!(i&&l)){o.preventDefault(),this.fireEvent("pasteImage",{clipboardData:t});return}if(!se){o.preventDefault(),l&&(!n||!r)?l.getAsString(O=>{this.insertHTML(O,!0)}):r&&r.getAsString(O=>{let D=!1,we=this.getSelection();if(!we.collapsed&&w.test(we.toString())){let Ie=this.linkRegExp.exec(O);D=!!Ie&&Ie[0].length===O.length}D?this.makeLink(O):this.insertPlainText(O,!0)});return}}let a=t?.types;if(!se&&a&&(Be.call(a,"text/html")>-1||!Fe&&Be.call(a,"text/plain")>-1&&Be.call(a,"text/rtf")<0)){o.preventDefault();let v;!n&&(v=t.getData("text/html"))?this.insertHTML(v,!0):((v=t.getData("text/plain"))||(v=t.getData("text/uri-list")))&&this.insertPlainText(v,!0);return}let d=document.body,c=this.getSelection(),f=c.startContainer,u=c.startOffset,p=c.endContainer,h=c.endOffset,T=m("DIV",{contenteditable:"true",style:"position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;"});d.appendChild(T),c.selectNodeContents(T),this.setSelection(c),setTimeout(()=>{try{let v="",O=T,D;for(;T=O;)O=T.nextSibling,E(T),D=T.firstChild,D&&D===T.lastChild&&D instanceof HTMLDivElement&&(T=D),v+=T.innerHTML;this.setSelection(X(f,u,p,h)),v&&this.insertHTML(v,!0)}catch(v){this._config.didError(v)}},0)},Ve=function(o){if(!o.dataTransfer)return;let t=o.dataTransfer.types,e=t.length,n=!1,i=!1;for(;e--;)switch(t[e]){case"text/plain":n=!0;break;case"text/html":i=!0;break;default:return}(i||n&&this.saveUndoState)&&this.saveUndoState()};var Ae=(o,t,e)=>{t.preventDefault(),o.splitBlock(t.shiftKey,e)};var te=(o,t)=>{try{t||(t=o.getSelection());let e=t.startContainer;e instanceof Text&&(e=e.parentNode);let n=e;for(;N(n)&&(!n.textContent||n.textContent===W);)e=n,n=e.parentNode;e!==n&&(t.setStart(n,Array.from(n.childNodes).indexOf(e)),t.collapse(!0),n.removeChild(e),H(n)||(n=z(n,o._root)||o._root),b(n),C(t)),e===o._root&&(e=e.firstChild)&&e.nodeName==="BR"&&E(e),o._ensureBottomLine(),o.setSelection(t),o._updatePath(t,!0)}catch(e){o._config.didError(e)}},Se=(o,t)=>{let e;for(;(e=o.parentNode)&&!(e===t||e.isContentEditable);)o=e;E(o)},Ee=(o,t,e)=>{if(g(t,o._root,"A"))return;let n=t.data||"",i=Math.max(n.lastIndexOf(" ",e-1),n.lastIndexOf("\xA0",e-1))+1,s=n.slice(i,e),r=o.linkRegExp.exec(s);if(r){let l=o.getSelection();o._docWasChanged(),o._recordUndoState(l),o._getRangeAndRemoveBookmark(l);let a=i+r.index,d=a+r[0].length;a&&(t=t.splitText(a));let c=o._config.tagAttributes.a,f=m("A",Object.assign({href:r[1]?/^(?:ht|f)tps?:/i.test(r[1])?r[1]:"http://"+r[1]:"mailto:"+r[0]},c));f.textContent=n.slice(a,d),t.parentNode.insertBefore(f,t);let u=l.startOffset;if(t.data=n.slice(d),l.startContainer===t){let p=u-d;l.setStart(t,p),l.setEnd(t,p)}o.setSelection(l)}};var Ye=(o,t,e)=>{let n=o._root;if(o._removeZWS(),o.saveUndoState(e),!e.collapsed)t.preventDefault(),F(e,n),te(o,e);else if(Q(e,n)){t.preventDefault();let i=R(e,n);if(!i)return;let s=i;B(s.parentNode,n);let r=z(s,n);if(r){if(!r.isContentEditable){Se(r,n);return}for($(r,s,e,n),s=r.parentNode;s!==n&&!s.nextSibling;)s=s.parentNode;s!==n&&(s=s.nextSibling)&&M(s,n),o.setSelection(e)}else if(s){if(g(s,n,"UL")||g(s,n,"OL")){o.decreaseListLevel(e);return}else if(g(s,n,"BLOCKQUOTE")){o.removeQuote(e);return}o.setSelection(e),o._updatePath(e,!0)}}else{C(e);let i=e.startContainer,s=e.startOffset,r=i.parentNode;i instanceof Text&&r instanceof HTMLAnchorElement&&s&&r.href.includes(i.data)?(i.deleteData(s-1,1),o.setSelection(e),o.removeLink()):(o.setSelection(e),setTimeout(()=>{te(o)},0))}};var Je=(o,t,e)=>{let n=o._root,i,s,r,l,a,d;if(o._removeZWS(),o.saveUndoState(e),!e.collapsed)t.preventDefault(),F(e,n),te(o,e);else if(oe(e,n)){if(t.preventDefault(),i=R(e,n),!i)return;if(B(i.parentNode,n),s=U(i,n),s){if(!s.isContentEditable){Se(s,n);return}for($(i,s,e,n),s=i.parentNode;s!==n&&!s.nextSibling;)s=s.parentNode;s!==n&&(s=s.nextSibling)&&M(s,n),o.setSelection(e),o._updatePath(e,!0)}}else{if(r=e.cloneRange(),P(e,n,n,n),l=e.endContainer,a=e.endOffset,l instanceof Element&&(d=l.childNodes[a],d&&d.nodeName==="IMG")){t.preventDefault(),E(d),C(e),te(o,e);return}o.setSelection(r),setTimeout(()=>{te(o)},0)}};var et=(o,t,e)=>{let n=o._root;if(o._removeZWS(),e.collapsed&&Q(e,n)){let i=R(e,n),s;for(;s=i.parentNode;){if(s.nodeName==="UL"||s.nodeName==="OL"){t.preventDefault(),o.increaseListLevel(e);break}i=s}}},tt=(o,t,e)=>{let n=o._root;if(o._removeZWS(),e.collapsed&&Q(e,n)){let i=e.startContainer;(g(i,n,"UL")||g(i,n,"OL"))&&(t.preventDefault(),o.decreaseListLevel(e))}};var nt=(o,t,e)=>{let n,i=o._root;if(o._recordUndoState(e),o._getRangeAndRemoveBookmark(e),e.collapsed||(F(e,i),o._ensureBottomLine(),o.setSelection(e),o._updatePath(e,!0)),n=e.endContainer,e.endOffset===k(n))do if(n.nodeName==="A"){e.setStartAfter(n);break}while(!n.nextSibling&&(n=n.parentNode)&&n!==i);if(o._config.addLinks){let s=e.cloneRange();C(s);let r=s.startContainer,l=s.startOffset;setTimeout(()=>{Ee(o,r,l)},0)}o.setSelection(e)};var bt={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",32:"Space",33:"PageUp",34:"PageDown",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",46:"Delete",191:"/",219:"[",220:"\\",221:"]"},ot=function(o){let t=o.keyCode,e=bt[t],n="",i=this.getSelection();o.defaultPrevented||(e||(e=String.fromCharCode(t).toLowerCase(),/^[A-Za-z0-9]$/.test(e)||(e="")),111<t&&t<124&&(e="F"+(t-111)),e!=="Backspace"&&e!=="Delete"&&(o.altKey&&(n+="Alt-"),o.ctrlKey&&(n+="Ctrl-"),o.metaKey&&(n+="Meta-"),o.shiftKey&&(n+="Shift-")),de&&o.shiftKey&&e==="Delete"&&(n+="Shift-"),e=n+e,this._keyHandlers[e]?this._keyHandlers[e](this,o,i):!i.collapsed&&!o.isComposing&&!o.ctrlKey&&!o.metaKey&&(o.key||e).length===1&&(this.saveUndoState(i),F(i,this._root),this._ensureBottomLine(),this.setSelection(i),this._updatePath(i,!0)))},x={Backspace:Ye,Delete:Je,Tab:et,"Shift-Tab":tt,Space:nt,ArrowLeft(o){o._removeZWS()},ArrowRight(o){o._removeZWS()}};He||(x.Enter=Ae,x["Shift-Enter"]=Ae);!ce&&!Ce&&(x.PageUp=o=>{o.moveCursorToStart()},x.PageDown=o=>{o.moveCursorToEnd()});var ie=(o,t)=>(t=t||null,(e,n)=>{n.preventDefault();let i=e.getSelection();e.hasFormat(o,null,i)?e.changeFormat(null,{tag:o},i):e.changeFormat({tag:o},t,i)});x[y+"b"]=ie("B");x[y+"i"]=ie("I");x[y+"u"]=ie("U");x[y+"Shift-7"]=ie("S");x[y+"Shift-5"]=ie("SUB",{tag:"SUP"});x[y+"Shift-6"]=ie("SUP",{tag:"SUB"});x[y+"Shift-8"]=(o,t)=>{t.preventDefault();let e=o.getPath();/(?:^|>)UL/.test(e)?o.removeList():o.makeUnorderedList()};x[y+"Shift-9"]=(o,t)=>{t.preventDefault();let e=o.getPath();/(?:^|>)OL/.test(e)?o.removeList():o.makeOrderedList()};x[y+"["]=(o,t)=>{t.preventDefault();let e=o.getPath();/(?:^|>)BLOCKQUOTE/.test(e)||!/(?:^|>)[OU]L/.test(e)?o.decreaseQuoteLevel():o.decreaseListLevel()};x[y+"]"]=(o,t)=>{t.preventDefault();let e=o.getPath();/(?:^|>)BLOCKQUOTE/.test(e)||!/(?:^|>)[OU]L/.test(e)?o.increaseQuoteLevel():o.increaseListLevel()};x[y+"d"]=(o,t)=>{t.preventDefault(),o.toggleCode()};x[y+"z"]=(o,t)=>{t.preventDefault(),o.undo()};x[y+"y"]=x[y+"Shift-z"]=(o,t)=>{t.preventDefault(),o.redo()};var Te=class{_root;_config;_isFocused;_lastSelection;_willRestoreSelection;_mayHaveZWS;_lastAnchorNode;_lastFocusNode;_path;_events;_undoIndex;_undoStack;_undoStackLength;_isInUndoState;_ignoreChange;_ignoreAllChanges;_isShiftDown;_keyHandlers;_mutation;constructor(t,e){this._root=t,this._config=this._makeConfig(e),this._isFocused=!1,this._lastSelection=X(t,0),this._willRestoreSelection=!1,this._mayHaveZWS=!1,this._lastAnchorNode=null,this._lastFocusNode=null,this._path="",this._events=new Map,this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0,this._isInUndoState=!1,this._ignoreChange=!1,this._ignoreAllChanges=!1,this.addEventListener("selectionchange",this._updatePathOnEvent),this.addEventListener("blur",this._enableRestoreSelection),this.addEventListener("mousedown",this._disableRestoreSelection),this.addEventListener("touchstart",this._disableRestoreSelection),this.addEventListener("focus",this._restoreSelection),this._isShiftDown=!1,this.addEventListener("cut",Qe),this.addEventListener("copy",Xe),this.addEventListener("paste",$e),this.addEventListener("drop",Ve),this.addEventListener("keydown",De),this.addEventListener("keyup",De),this.addEventListener("keydown",ot),this._keyHandlers=Object.create(x);let n=new MutationObserver(()=>this._docWasChanged());n.observe(t,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._mutation=n,t.setAttribute("contenteditable","true");try{document.execCommand("enableObjectResizing",!1,"false"),document.execCommand("enableInlineTableEditing",!1,"false")}catch{}this.addEventListener("beforeinput",this._beforeInput),this.setHTML("")}destroy(){this._events.forEach((t,e)=>{this.removeEventListener(e)}),this._mutation.disconnect(),this._undoIndex=-1,this._undoStack=[],this._undoStackLength=0}_makeConfig(t){let e={blockTag:"DIV",blockAttributes:null,tagAttributes:{},classNames:{color:"color",fontFamily:"font",fontSize:"size",highlight:"highlight"},undo:{documentSizeThreshold:-1,undoLimit:-1},addLinks:!0,willCutCopy:null,sanitizeToDOMFragment:n=>{let i=DOMPurify.sanitize(n,{ALLOW_UNKNOWN_PROTOCOLS:!0,WHOLE_DOCUMENT:!1,RETURN_DOM:!0,RETURN_DOM_FRAGMENT:!0,FORCE_BODY:!1});return i?document.importNode(i,!0):document.createDocumentFragment()},didError:n=>console.log(n)};return t&&(Object.assign(e,t),e.blockTag=e.blockTag.toUpperCase()),e}setKeyHandler(t,e){return this._keyHandlers[t]=e,this}_beforeInput(t){switch(t.inputType){case"insertText":Me&&t.data&&t.data.includes(`
`)&&t.preventDefault();break;case"insertLineBreak":t.preventDefault(),this.splitBlock(!0);break;case"insertParagraph":t.preventDefault(),this.splitBlock(!1);break;case"insertOrderedList":t.preventDefault(),this.makeOrderedList();break;case"insertUnoderedList":t.preventDefault(),this.makeUnorderedList();break;case"historyUndo":t.preventDefault(),this.undo();break;case"historyRedo":t.preventDefault(),this.redo();break;case"formatBold":t.preventDefault(),this.bold();break;case"formaItalic":t.preventDefault(),this.italic();break;case"formatUnderline":t.preventDefault(),this.underline();break;case"formatStrikeThrough":t.preventDefault(),this.strikethrough();break;case"formatSuperscript":t.preventDefault(),this.superscript();break;case"formatSubscript":t.preventDefault(),this.subscript();break;case"formatJustifyFull":case"formatJustifyCenter":case"formatJustifyRight":case"formatJustifyLeft":{t.preventDefault();let e=t.inputType.slice(13).toLowerCase();e==="full"&&(e="justify"),this.setTextAlignment(e);break}case"formatRemove":t.preventDefault(),this.removeAllFormatting();break;case"formatSetBlockTextDirection":{t.preventDefault();let e=t.data;e==="null"&&(e=null),this.setTextDirection(e);break}case"formatBackColor":t.preventDefault(),this.setHighlightColor(t.data);break;case"formatFontColor":t.preventDefault(),this.setTextColor(t.data);break;case"formatFontName":t.preventDefault(),this.setFontFace(t.data);break}}handleEvent(t){this.fireEvent(t.type,t)}fireEvent(t,e){let n=this._events.get(t);if(/^(?:focus|blur)/.test(t)){let i=this._root===document.activeElement;if(t==="focus"){if(!i||this._isFocused)return this;this._isFocused=!0}else{if(i||!this._isFocused)return this;this._isFocused=!1}}if(n){let i=e instanceof Event?e:new CustomEvent(t,{detail:e});n=n.slice();for(let s of n)try{"handleEvent"in s?s.handleEvent(i):s.call(this,i)}catch(r){this._config.didError(r)}}return this}customEvents=new Set(["pathChange","select","input","pasteImage","undoStateChange"]);addEventListener(t,e){let n=this._events.get(t),i=this._root;return n||(n=[],this._events.set(t,n),this.customEvents.has(t)||(t==="selectionchange"&&(i=document),i.addEventListener(t,this,!0))),n.push(e),this}removeEventListener(t,e){let n=this._events.get(t),i=this._root;if(n){if(e){let s=n.length;for(;s--;)n[s]===e&&n.splice(s,1)}else n.length=0;n.length||(this._events.delete(t),this.customEvents.has(t)||(t==="selectionchange"&&(i=document),i.removeEventListener(t,this,!0)))}return this}focus(){return this._root.focus({preventScroll:!0}),this}blur(){return this._root.blur(),this}_enableRestoreSelection(){this._willRestoreSelection=!0}_disableRestoreSelection(){this._willRestoreSelection=!1}_restoreSelection(){this._willRestoreSelection&&this.setSelection(this._lastSelection)}_removeZWS(){this._mayHaveZWS&&(me(this._root),this._mayHaveZWS=!1)}startSelectionId="squire-selection-start";endSelectionId="squire-selection-end";_saveRangeToBookmark(t){let e=m("INPUT",{id:this.startSelectionId,type:"hidden"}),n=m("INPUT",{id:this.endSelectionId,type:"hidden"}),i;Z(t,e),t.collapse(!1),Z(t,n),e.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_PRECEDING&&(e.id=this.endSelectionId,n.id=this.startSelectionId,i=e,e=n,n=i),t.setStartAfter(e),t.setEndBefore(n)}_getRangeAndRemoveBookmark(t){let e=this._root,n=e.querySelector("#"+this.startSelectionId),i=e.querySelector("#"+this.endSelectionId);if(n&&i){let s=n.parentNode,r=i.parentNode,l=Array.from(s.childNodes).indexOf(n),a=Array.from(r.childNodes).indexOf(i);s===r&&(a-=1),n.remove(),i.remove(),t||(t=document.createRange()),t.setStart(s,l),t.setEnd(r,a),J(s,t),s!==r&&J(r,t),t.collapsed&&(s=t.startContainer,s instanceof Text&&(r=s.childNodes[t.startOffset],(!r||!(r instanceof Text))&&(r=s.childNodes[t.startOffset-1]),r&&r instanceof Text&&(t.setStart(r,0),t.collapse(!0))))}return t||null}getSelection(){let t=window.getSelection(),e=this._root,n=null;if(this._isFocused&&t&&t.rangeCount){n=t.getRangeAt(0).cloneRange();let i=n.startContainer,s=n.endContainer;i&&I(i)&&n.setStartBefore(i),s&&I(s)&&n.setEndBefore(s)}return n&&e.contains(n.commonAncestorContainer)?this._lastSelection=n:(n=this._lastSelection,document.contains(n.commonAncestorContainer)||(n=null)),n||(n=X(e.firstElementChild||e,0)),n}setSelection(t){if(this._lastSelection=t,!this._isFocused)this._enableRestoreSelection();else{let e=window.getSelection();e&&("setBaseAndExtent"in Selection.prototype?e.setBaseAndExtent(t.startContainer,t.startOffset,t.endContainer,t.endOffset):(e.removeAllRanges(),e.addRange(t)))}return this}_moveCursorTo(t){let e=this._root,n=X(e,t?0:e.childNodes.length);return C(n),this.setSelection(n),this}moveCursorToStart(){return this._moveCursorTo(!0)}moveCursorToEnd(){return this._moveCursorTo(!1)}getCursorPosition(){let t=this.getSelection(),e=t.getBoundingClientRect();if(e&&!e.top){this._ignoreChange=!0;let n=m("SPAN");n.textContent=W,Z(t,n),e=n.getBoundingClientRect();let i=n.parentNode;i.removeChild(n),J(i,t)}return e}getPath(){return this._path}_updatePathOnEvent(){this._isFocused&&this._updatePath(this.getSelection())}_updatePath(t,e){let n=t.startContainer,i=t.endContainer,s;(e||n!==this._lastAnchorNode||i!==this._lastFocusNode)&&(this._lastAnchorNode=n,this._lastFocusNode=i,s=n&&i?n===i?this._getPath(i):"(selection)":"",this._path!==s&&(this._path=s,this.fireEvent("pathChange",{path:s}))),this.fireEvent(t.collapsed?"cursor":"select",{range:t})}_getPath(t){let e=this._root,n=this._config,i="";if(t&&t!==e){let s=t.parentNode;if(i=s?this._getPath(s):"",t instanceof HTMLElement){let r=t.id,l=t.classList,a=Array.from(l).sort(),d=t.dir,c=n.classNames;i+=(i?">":"")+t.nodeName,r&&(i+="#"+r),a.length&&(i+=".",i+=a.join(".")),d&&(i+="[dir="+d+"]"),l.contains(c.highlight)&&(i+="[backgroundColor="+t.style.backgroundColor.replace(/ /g,"")+"]"),l.contains(c.color)&&(i+="[color="+t.style.color.replace(/ /g,"")+"]"),l.contains(c.fontFamily)&&(i+="[fontFamily="+t.style.fontFamily.replace(/ /g,"")+"]"),l.contains(c.fontSize)&&(i+="[fontSize="+t.style.fontSize+"]")}}return i}modifyDocument(t){let e=this._mutation;return e&&(e.takeRecords().length&&this._docWasChanged(),e.disconnect()),this._ignoreAllChanges=!0,t(),this._ignoreAllChanges=!1,e&&(e.observe(this._root,{childList:!0,attributes:!0,characterData:!0,subtree:!0}),this._ignoreChange=!1),this}_docWasChanged(){if(qe(),this._mayHaveZWS=!0,!this._ignoreAllChanges){if(this._ignoreChange){this._ignoreChange=!1;return}this._isInUndoState&&(this._isInUndoState=!1,this.fireEvent("undoStateChange",{canUndo:!0,canRedo:!1})),this.fireEvent("input")}}_recordUndoState(t,e){if(!this._isInUndoState||e){let n=this._undoIndex,i=this._undoStack,s=this._config.undo,r=s.documentSizeThreshold,l=s.undoLimit;e||(n+=1),n<this._undoStackLength&&(i.length=this._undoStackLength=n),t&&this._saveRangeToBookmark(t);let a=this._getRawHTML();r>-1&&a.length*2>r&&l>-1&&n>l&&(i.splice(0,n-l),n=l,this._undoStackLength=l),i[n]=a,this._undoIndex=n,this._undoStackLength+=1,this._isInUndoState=!0}return this}saveUndoState(t){return t||(t=this.getSelection()),this._recordUndoState(t,this._isInUndoState),this._getRangeAndRemoveBookmark(t),this}undo(){if(this._undoIndex!==0||!this._isInUndoState){this._recordUndoState(this.getSelection(),!1),this._undoIndex-=1,this._setRawHTML(this._undoStack[this._undoIndex]);let t=this._getRangeAndRemoveBookmark();t&&this.setSelection(t),this._isInUndoState=!0,this.fireEvent("undoStateChange",{canUndo:this._undoIndex!==0,canRedo:!0}),this.fireEvent("input")}return this}redo(){let t=this._undoIndex,e=this._undoStackLength;if(t+1<e&&this._isInUndoState){this._undoIndex+=1,this._setRawHTML(this._undoStack[this._undoIndex]);let n=this._getRangeAndRemoveBookmark();n&&this.setSelection(n),this.fireEvent("undoStateChange",{canUndo:!0,canRedo:t+2<e}),this.fireEvent("input")}return this}getRoot(){return this._root}_getRawHTML(){return this._root.innerHTML}_setRawHTML(t){let e=this._root;e.innerHTML=t;let n=e,i=n.firstChild;if(!i||i.nodeName==="BR"){let s=this.createDefaultBlock();i?n.replaceChild(s,i):n.appendChild(s)}else for(;n=U(n,e);)b(n);return this._ignoreChange=!0,this}getHTML(t){let e;t&&(e=this.getSelection(),this._saveRangeToBookmark(e));let n=this._getRawHTML().replace(/\u200B/g,"");return t&&this._getRangeAndRemoveBookmark(e),n}setHTML(t){let e=this._config.sanitizeToDOMFragment(t,this),n=this._root;Ne(e,this._config),ee(e,n,!1),B(e,n);let i=e,s=i.firstChild;if(!s||s.nodeName==="BR"){let l=this.createDefaultBlock();s?i.replaceChild(l,s):i.appendChild(l)}else for(;i=U(i,n);)b(i);for(this._ignoreChange=!0;s=n.lastChild;)n.removeChild(s);n.appendChild(e),this._undoIndex=-1,this._undoStack.length=0,this._undoStackLength=0,this._isInUndoState=!1;let r=this._getRangeAndRemoveBookmark()||X(n.firstElementChild||n,0);return this.saveUndoState(r),this.setSelection(r),this._updatePath(r,!0),this}insertHTML(t,e){let n=this._config,i=n.sanitizeToDOMFragment(t,this),s=this.getSelection();this.saveUndoState(s);try{let r=this._root;n.addLinks&&this.addDetectedLinks(i,i),Ne(i,this._config),ee(i,r,!1),ge(i),i.normalize();let l=i;for(;l=U(l,i);)b(l);let a=!0;if(e){let d=new CustomEvent("willPaste",{detail:{fragment:i}});this.fireEvent("willPaste",d),i=d.detail.fragment,a=!d.defaultPrevented}a&&(Ze(s,i,r),s.collapse(!1),Re(s,"A",r),this._ensureBottomLine()),this.setSelection(s),this._updatePath(s,!0),e&&this.focus()}catch(r){this._config.didError(r)}return this}insertElement(t,e){if(e||(e=this.getSelection()),e.collapse(!0),N(t))Z(e,t),e.setStartAfter(t);else{let n=this._root,i=R(e,n),s=i||n,r=null;for(;s!==n&&!s.nextSibling;)s=s.parentNode;if(s!==n){let a=s.parentNode;r=A(a,s.nextSibling,n,n)}i&&ae(i)&&E(i),n.insertBefore(t,r);let l=this.createDefaultBlock();n.insertBefore(l,r),e.setStart(l,0),e.setEnd(l,0),C(e)}return this.focus(),this.setSelection(e),this._updatePath(e),this}insertImage(t,e){let n=m("IMG",Object.assign({src:t},e));return this.insertElement(n),n}insertPlainText(t,e){let n=this.getSelection();if(n.collapsed&&g(n.startContainer,this._root,"PRE")){let c=n.startContainer,f=n.startOffset,u;if(!c||!(c instanceof Text)){let h=document.createTextNode("");c.insertBefore(h,c.childNodes[f]),u=h,f=0}else u=c;let p=!0;if(e){let h=new CustomEvent("willPaste",{detail:{text:t}});this.fireEvent("willPaste",h),t=h.detail.text,p=!h.defaultPrevented}return p&&(u.insertData(f,t),n.setStart(u,f+t.length),n.collapse(!0)),this.setSelection(n),this}let i=t.split(`
`),s=this._config,r=s.blockTag,l=s.blockAttributes,a="</"+r+">",d="<"+r;for(let c in l)d+=" "+c+'="'+Oe(l[c])+'"';d+=">";for(let c=0,f=i.length;c<f;c+=1){let u=i[c];u=Oe(u).replace(/ (?=(?: |$))/g,"&nbsp;"),c&&(u=d+(u||"<BR>")+a),i[c]=u}return this.insertHTML(i.join(""),e)}getSelectedText(){let t=this.getSelection();if(t.collapsed)return"";let e=t.startContainer,n=t.endContainer,i=new _(t.commonAncestorContainer,5,d=>K(t,d,!0));i.currentNode=e;let s=e,r="",l=!1,a;for((!(s instanceof Element)&&!(s instanceof Text)||!i.filter(s))&&(s=i.nextNode());s;)s instanceof Text?(a=s.data,a&&/\S/.test(a)&&(s===n&&(a=a.slice(0,t.endOffset)),s===e&&(a=a.slice(t.startOffset)),r+=a,l=!0)):(s.nodeName==="BR"||l&&!N(s))&&(r+=`
`,l=!1),s=i.nextNode();return r}getFontInfo(t){let e={color:void 0,backgroundColor:void 0,fontFamily:void 0,fontSize:void 0};t||(t=this.getSelection());let n=0,i=t.commonAncestorContainer;if(t.collapsed||i instanceof Text)for(i instanceof Text&&(i=i.parentNode);n<4&&i;){let s=i.style;if(s){let r=s.color;!e.color&&r&&(e.color=r,n+=1);let l=s.backgroundColor;!e.backgroundColor&&l&&(e.backgroundColor=l,n+=1);let a=s.fontFamily;!e.fontFamily&&a&&(e.fontFamily=a,n+=1);let d=s.fontSize;!e.fontSize&&d&&(e.fontSize=d,n+=1)}i=i.parentNode}return e}hasFormat(t,e,n){t=t.toUpperCase(),e||(e={}),n||(n=this.getSelection()),!n.collapsed&&n.startContainer instanceof Text&&n.startOffset===n.startContainer.length&&n.startContainer.nextSibling&&n.setStartBefore(n.startContainer.nextSibling),!n.collapsed&&n.endContainer instanceof Text&&n.endOffset===0&&n.endContainer.previousSibling&&n.setEndAfter(n.endContainer.previousSibling);let i=this._root,s=n.commonAncestorContainer;if(g(s,i,t,e))return!0;if(s instanceof Text)return!1;let r=new _(s,4,d=>K(n,d,!0)),l=!1,a;for(;a=r.nextNode();){if(!g(a,i,t,e))return!1;l=!0}return l}changeFormat(t,e,n,i){return n||(n=this.getSelection()),this.saveUndoState(n),e&&(n=this._removeFormat(e.tag.toUpperCase(),e.attributes||{},n,i)),t&&(n=this._addFormat(t.tag.toUpperCase(),t.attributes||{},n)),this.setSelection(n),this._updatePath(n,!0),this.focus()}_addFormat(t,e,n){let i=this._root;if(n.collapsed){let s=b(m(t,e));Z(n,s);let r=s.firstChild||s,l=r instanceof Text?r.length:0;n.setStart(r,l),n.collapse(!0);let a=s;for(;N(a);)a=a.parentNode;me(a,s)}else{let s=new _(n.commonAncestorContainer,5,c=>(c instanceof Text||c.nodeName==="BR"||c.nodeName==="IMG")&&K(n,c,!0)),{startContainer:r,startOffset:l,endContainer:a,endOffset:d}=n;if(s.currentNode=r,!(r instanceof Element)&&!(r instanceof Text)||!s.filter(r)){let c=s.nextNode();if(!c)return n;r=c,l=0}do{let c=s.currentNode;if(!g(c,i,t,e)){c===a&&c.length>d&&c.splitText(d),c===r&&l&&(c=c.splitText(l),a===r?(a=c,d-=l):a===r.parentNode&&(d+=1),r=c,l=0);let u=m(t,e);L(c,u),u.appendChild(c)}}while(s.nextNode());n=X(r,l,a,d)}return n}_removeFormat(t,e,n,i){this._saveRangeToBookmark(n);let s;n.collapsed&&(re?s=document.createTextNode(W):s=document.createTextNode(""),Z(n,s));let r=n.commonAncestorContainer;for(;N(r);)r=r.parentNode;let l=n.startContainer,a=n.startOffset,d=n.endContainer,c=n.endOffset,f=[],u=(h,T)=>{if(K(n,h,!1))return;let v,O;if(!K(n,h,!0)){!(h instanceof HTMLInputElement)&&(!(h instanceof Text)||h.data)&&f.push([T,h]);return}if(h instanceof Text)h===d&&c!==h.length&&f.push([T,h.splitText(c)]),h===l&&a&&(h.splitText(a),f.push([T,h]));else for(v=h.firstChild;v;v=O)O=v.nextSibling,u(v,T)},p=Array.from(r.getElementsByTagName(t)).filter(h=>K(n,h,!0)&&ue(h,t,e));return i||p.forEach(h=>{u(h,h)}),f.forEach(([h,T])=>{h=h.cloneNode(!1),L(T,h),h.appendChild(T)}),p.forEach(h=>{L(h,S(h))}),this._getRangeAndRemoveBookmark(n),s&&n.collapse(!1),J(r,n),n}bold(){return this.changeFormat({tag:"B"})}removeBold(){return this.changeFormat(null,{tag:"B"})}italic(){return this.changeFormat({tag:"I"})}removeItalic(){return this.changeFormat(null,{tag:"I"})}underline(){return this.changeFormat({tag:"U"})}removeUnderline(){return this.changeFormat(null,{tag:"U"})}strikethrough(){return this.changeFormat({tag:"S"})}removeStrikethrough(){return this.changeFormat(null,{tag:"S"})}subscript(){return this.changeFormat({tag:"SUB"},{tag:"SUP"})}removeSubscript(){return this.changeFormat(null,{tag:"SUB"})}superscript(){return this.changeFormat({tag:"SUP"},{tag:"SUB"})}removeSuperscript(){return this.changeFormat(null,{tag:"SUP"})}makeLink(t,e){let n=this.getSelection();if(n.collapsed){let i=t.indexOf(":")+1;if(i)for(;t[i]==="/";)i+=1;Z(n,document.createTextNode(t.slice(i)))}return e=Object.assign({href:t},this._config.tagAttributes.a,e),this.changeFormat({tag:"A",attributes:e},{tag:"A"},n)}removeLink(){return this.changeFormat(null,{tag:"A"},this.getSelection(),!0)}linkRegExp=/\b(?:((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9][a-z0-9.\-]*[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:[^\s?&`!()\[\]{};:'".,<>«»“”‘’]|\([^\s()<>]+\)))|([\w\-.%+]+@(?:[\w\-]+\.)+[a-z]{2,}\b(?:[?][^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+(?:&[^&?\s]+=[^\s?&`!()\[\]{};:'".,<>«»“”‘’]+)*)?))/i;addDetectedLinks(t,e){let n=new _(t,4,l=>!g(l,e||this._root,"A")),i=this.linkRegExp,s=this._config.tagAttributes.a,r;for(;r=n.nextNode();){let l=r.parentNode,a=r.data,d;for(;d=i.exec(a);){let c=d.index,f=c+d[0].length;c&&l.insertBefore(document.createTextNode(a.slice(0,c)),r);let u=m("A",Object.assign({href:d[1]?/^(?:ht|f)tps?:/i.test(d[1])?d[1]:"http://"+d[1]:"mailto:"+d[0]},s));u.textContent=a.slice(c,f),l.insertBefore(u,r),r.data=a=a.slice(f)}}return this}setFontFace(t){let e=this._config.classNames.fontFamily;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"font-family: "+t+", sans-serif;"}}:null,{tag:"SPAN",attributes:{class:e}})}setFontSize(t){let e=this._config.classNames.fontSize;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"font-size: "+(typeof t=="number"?t+"px":t)}}:null,{tag:"SPAN",attributes:{class:e}})}setTextColor(t){let e=this._config.classNames.color;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"color:"+t}}:null,{tag:"SPAN",attributes:{class:e}})}setHighlightColor(t){let e=this._config.classNames.highlight;return this.changeFormat(t?{tag:"SPAN",attributes:{class:e,style:"background-color:"+t}}:null,{tag:"SPAN",attributes:{class:e}})}_ensureBottomLine(){let t=this._root,e=t.lastElementChild;(!e||e.nodeName!==this._config.blockTag||!H(e))&&t.appendChild(this.createDefaultBlock())}createDefaultBlock(t){let e=this._config;return b(m(e.blockTag,e.blockAttributes,t))}tagAfterSplit={DT:"DD",DD:"DT",LI:"LI",PRE:"PRE"};splitBlock(t,e){e||(e=this.getSelection());let n=this._root,i,s,r,l;if(this._recordUndoState(e),this._removeZWS(),this._getRangeAndRemoveBookmark(e),e.collapsed||F(e,n),this._config.addLinks){C(e);let u=e.startContainer,p=e.startOffset;setTimeout(()=>{Ee(this,u,p)},0)}if(i=R(e,n),i&&(s=g(i,n,"PRE"))){C(e),r=e.startContainer;let u=e.startOffset;return r instanceof Text||(r=document.createTextNode(""),s.insertBefore(r,s.firstChild)),!t&&r instanceof Text&&(r.data.charAt(u-1)===`
`||Q(e,n))&&(r.data.charAt(u)===`
`||oe(e,n))?(r.deleteData(u&&u-1,u?2:1),l=A(r,u&&u-1,n,n),r=l.previousSibling,r.textContent||E(r),r=this.createDefaultBlock(),l.parentNode.insertBefore(r,l),l.textContent||E(l),e.setStart(r,0)):(r.insertData(u,`
`),b(s),r.length===u+1?e.setStartAfter(r):e.setStart(r,u+1)),e.collapse(!0),this.setSelection(e),this._updatePath(e,!0),this._docWasChanged(),this}if(!i||t||/^T[HD]$/.test(i.nodeName))return Re(e,"A",n),Z(e,m("BR")),e.collapse(!1),this.setSelection(e),this._updatePath(e,!0),this;if((s=g(i,n,"LI"))&&(i=s),ae(i)){if(g(i,n,"UL")||g(i,n,"OL"))return this.decreaseListLevel(e),this;if(g(i,n,"BLOCKQUOTE"))return this.removeQuote(e),this}r=e.startContainer;let a=e.startOffset,d=this.tagAfterSplit[i.nodeName];l=A(r,a,i.parentNode,this._root);let c=this._config,f=null;for(d||(d=c.blockTag,f=c.blockAttributes),ue(l,d,f)||(i=m(d,f),l.dir&&(i.dir=l.dir),L(l,i),i.appendChild(S(l)),l=i),me(i),ge(i),b(i);l instanceof Element;){let u=l.firstChild,p;if(l.nodeName==="A"&&(!l.textContent||l.textContent===W)){u=document.createTextNode(""),L(l,u),l=u;break}for(;u&&u instanceof Text&&!u.data&&(p=u.nextSibling,!(!p||p.nodeName==="BR"));)E(u),u=p;if(!u||u.nodeName==="BR"||u instanceof Text)break;l=u}return e=X(l,0),this.setSelection(e),this._updatePath(e,!0),this}forEachBlock(t,e,n){n||(n=this.getSelection()),e&&this.saveUndoState(n);let i=this._root,s=R(n,i),r=G(n,i);if(s&&r)do if(t(s)||s===r)break;while(s=U(s,i));return e&&(this.setSelection(n),this._updatePath(n,!0)),this}modifyBlocks(t,e){e||(e=this.getSelection()),this._recordUndoState(e,this._isInUndoState);let n=this._root;ke(e,n),P(e,n,n,n);let i=ye(e,n,n);if(!e.collapsed){let s=e.endContainer;if(s===n)e.collapse(!1);else{for(;s.parentNode!==n;)s=s.parentNode;e.setStartBefore(s),e.collapse(!0)}}return Z(e,t.call(this,i)),e.endOffset<e.endContainer.childNodes.length&&M(e.endContainer.childNodes[e.endOffset],n),M(e.startContainer.childNodes[e.startOffset],n),this._getRangeAndRemoveBookmark(e),this.setSelection(e),this._updatePath(e,!0),this}setTextAlignment(t){return this.forEachBlock(e=>{let n=e.className.split(/\s+/).filter(i=>!!i&&!/^align/.test(i)).join(" ");t?(e.className=n+" align-"+t,e.style.textAlign=t):(e.className=n,e.style.textAlign="")},!0),this.focus()}setTextDirection(t){return this.forEachBlock(e=>{t?e.dir=t:e.removeAttribute("dir")},!0),this.focus()}_getListSelection(t,e){let n=t.commonAncestorContainer,i=t.startContainer,s=t.endContainer;for(;n&&n!==e&&!/^[OU]L$/.test(n.nodeName);)n=n.parentNode;if(!n||n===e)return null;for(i===n&&(i=i.childNodes[t.startOffset]),s===n&&(s=s.childNodes[t.endOffset]);i&&i.parentNode!==n;)i=i.parentNode;for(;s&&s.parentNode!==n;)s=s.parentNode;return[n,i,s]}increaseListLevel(t){t||(t=this.getSelection());let e=this._root,n=this._getListSelection(t,e);if(!n)return this.focus();let[i,s,r]=n;if(!s||s===i.firstChild)return this.focus();this._recordUndoState(t,this._isInUndoState);let l=i.nodeName,a=s.previousSibling,d,c;a.nodeName!==l&&(d=this._config.tagAttributes[l.toLowerCase()],a=m(l,d),i.insertBefore(a,s));do c=s===r?null:s.nextSibling,a.appendChild(s);while(s=c);return c=a.nextSibling,c&&M(c,e),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}decreaseListLevel(t){t||(t=this.getSelection());let e=this._root,n=this._getListSelection(t,e);if(!n)return this.focus();let[i,s,r]=n;s||(s=i.firstChild),r||(r=i.lastChild),this._recordUndoState(t,this._isInUndoState);let l,a=null;if(s){let d=i.parentNode;if(a=r.nextSibling?A(i,r.nextSibling,d,e):i.nextSibling,d!==e&&d.nodeName==="LI"){for(d=d.parentNode;a;)l=a.nextSibling,r.appendChild(a),a=l;a=i.parentNode.nextSibling}let c=!/^[OU]L$/.test(d.nodeName);do l=s===r?null:s.nextSibling,i.removeChild(s),c&&s.nodeName==="LI"&&(s=this.createDefaultBlock([S(s)])),d.insertBefore(s,a);while(s=l)}return i.firstChild||E(i),a&&M(a,e),this._getRangeAndRemoveBookmark(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}_makeList(t,e){let n=le(t,this._root),i=this._config.tagAttributes,s=i[e.toLowerCase()],r=i.li,l;for(;l=n.nextNode();)if(l.parentNode instanceof HTMLLIElement&&(l=l.parentNode,n.currentNode=l.lastChild),l instanceof HTMLLIElement){l=l.parentNode;let a=l.nodeName;a!==e&&/^[OU]L$/.test(a)&&L(l,m(e,s,[S(l)]))}else{let a=m("LI",r);l.dir&&(a.dir=l.dir);let d=l.previousSibling;d&&d.nodeName===e?(d.appendChild(a),E(l)):L(l,m(e,s,[a])),a.appendChild(S(l)),n.currentNode=a}return t}makeUnorderedList(){return this.modifyBlocks(t=>this._makeList(t,"UL")),this.focus()}makeOrderedList(){return this.modifyBlocks(t=>this._makeList(t,"OL")),this.focus()}removeList(){return this.modifyBlocks(t=>{let e=t.querySelectorAll("UL, OL"),n=t.querySelectorAll("LI"),i=this._root;for(let s=0,r=e.length;s<r;s+=1){let l=e[s],a=S(l);B(a,i),L(l,a)}for(let s=0,r=n.length;s<r;s+=1){let l=n[s];H(l)?L(l,this.createDefaultBlock([S(l)])):(B(l,i),L(l,S(l)))}return t}),this.focus()}increaseQuoteLevel(t){return this.modifyBlocks(e=>m("BLOCKQUOTE",this._config.tagAttributes.blockquote,[e]),t),this.focus()}decreaseQuoteLevel(t){return this.modifyBlocks(e=>(Array.from(e.querySelectorAll("blockquote")).filter(n=>!g(n.parentNode,e,"BLOCKQUOTE")).forEach(n=>{L(n,S(n))}),e),t),this.focus()}removeQuote(t){return this.modifyBlocks(()=>this.createDefaultBlock([m("INPUT",{id:this.startSelectionId,type:"hidden"}),m("INPUT",{id:this.endSelectionId,type:"hidden"})]),t),this.focus()}code(){let t=this.getSelection();return t.collapsed||j(t.commonAncestorContainer)?(this.modifyBlocks(e=>{let n=this._root,i=document.createDocumentFragment(),s=le(e,n),r;for(;r=s.nextNode();){let a=r.querySelectorAll("BR"),d=[],c=a.length;for(let f=0;f<c;f+=1)d[f]=Y(a[f],!1);for(;c--;){let f=a[c];d[c]?L(f,document.createTextNode(`
`)):E(f)}for(a=r.querySelectorAll("CODE"),c=a.length;c--;)L(a[c],S(a[c]));i.childNodes.length&&i.appendChild(document.createTextNode(`
`)),i.appendChild(S(r))}let l=new _(i,4);for(;r=l.nextNode();)r.data=r.data.replace(/ /g," ");return i.normalize(),b(m("PRE",this._config.tagAttributes.pre,[i]))},t),this.focus()):this.changeFormat({tag:"CODE",attributes:this._config.tagAttributes.code},null,t),this}removeCode(){let t=this.getSelection(),e=t.commonAncestorContainer;return g(e,this._root,"PRE")?(this.modifyBlocks(i=>{let s=this._root,r=i.querySelectorAll("PRE"),l=r.length;for(;l--;){let a=r[l],d=new _(a,4),c;for(;c=d.nextNode();){let f=c.data;f=f.replace(/ (?= )/g,"\xA0");let u=document.createDocumentFragment(),p;for(;(p=f.indexOf(`
`))>-1;)u.appendChild(document.createTextNode(f.slice(0,p))),u.appendChild(m("BR")),f=f.slice(p+1);c.parentNode.insertBefore(u,c),c.data=f}B(a,s),L(a,S(a))}return i},t),this.focus()):this.changeFormat(null,{tag:"CODE"},t),this}toggleCode(){return this.hasFormat("PRE")||this.hasFormat("CODE")?this.removeCode():this.code(),this}_removeFormatting(t,e){for(let n=t.firstChild,i;n;n=i){if(i=n.nextSibling,N(n)){if(n instanceof Text||n.nodeName==="BR"||n.nodeName==="IMG"){e.appendChild(n);continue}}else if(H(n)){e.appendChild(this.createDefaultBlock([this._removeFormatting(n,document.createDocumentFragment())]));continue}this._removeFormatting(n,e)}return e}removeAllFormatting(t){if(t||(t=this.getSelection()),t.collapsed)return this;let e=this._root,n=t.commonAncestorContainer;for(;n&&!H(n);)n=n.parentNode;if(n||(ke(t,e),n=e),n instanceof Text)return this;this.saveUndoState(t),P(t,n,n,e);let i=t.startContainer,s=t.startOffset,r=t.endContainer,l=t.endOffset,a=document.createDocumentFragment(),d=document.createDocumentFragment(),c=A(r,l,n,e),f=A(i,s,n,e),u;for(;f!==c;)u=f.nextSibling,a.appendChild(f),f=u;if(this._removeFormatting(a,d),d.normalize(),f=d.firstChild,u=d.lastChild,f){n.insertBefore(d,c);let p=Array.from(n.childNodes);s=p.indexOf(f),l=u?p.indexOf(u)+1:0}else c&&(s=Array.from(n.childNodes).indexOf(c),l=s);return t.setStart(n,s),t.setEnd(n,l),J(n,t),C(t),this.setSelection(t),this._updatePath(t,!0),this.focus()}};var Ro=Te;export{Ro as default};
//# sourceMappingURL=squire.mjs.map
